{"version":3,"sources":["../../../../../src/client/components/router-reducer/reducers/navigate-reducer.ts"],"sourcesContent":["import type {\n  NavigateAction,\n  ReadonlyReducerState,\n  ReducerState,\n} from '../router-reducer-types'\n\nimport {\n  completeHardNavigation,\n  navigate as navigateUsingSegmentCache,\n} from '../../segment-cache/navigation'\nimport { getStaleTimeMs } from '../../segment-cache/cache'\nimport { FreshnessPolicy } from '../ppr-navigations'\n\n// These values are set by `define-env-plugin` (based on `nextConfig.experimental.staleTimes`)\n// and default to 5 minutes (static) / 0 seconds (dynamic)\nexport const DYNAMIC_STALETIME_MS =\n  Number(process.env.__NEXT_CLIENT_ROUTER_DYNAMIC_STALETIME) * 1000\n\nexport const STATIC_STALETIME_MS = getStaleTimeMs(\n  Number(process.env.__NEXT_CLIENT_ROUTER_STATIC_STALETIME)\n)\n\nexport function navigateReducer(\n  state: ReadonlyReducerState,\n  action: NavigateAction\n): ReducerState {\n  const { url, isExternalUrl, navigateType, shouldScroll } = action\n\n  if (isExternalUrl) {\n    return completeHardNavigation(state, url, navigateType)\n  }\n\n  // Handles case where `<meta http-equiv=\"refresh\">` tag is present,\n  // which will trigger an MPA navigation.\n  if (document.getElementById('__next-page-redirect')) {\n    return completeHardNavigation(state, url, navigateType)\n  }\n\n  // Temporary glue code between the router reducer and the new navigation\n  // implementation. Eventually we'll rewrite the router reducer to a\n  // state machine.\n  const currentUrl = new URL(state.canonicalUrl, location.origin)\n  const currentRenderedSearch = state.renderedSearch\n  return navigateUsingSegmentCache(\n    state,\n    url,\n    currentUrl,\n    currentRenderedSearch,\n    state.cache,\n    state.tree,\n    state.nextUrl,\n    FreshnessPolicy.Default,\n    shouldScroll,\n    navigateType\n  )\n}\n"],"names":["DYNAMIC_STALETIME_MS","STATIC_STALETIME_MS","navigateReducer","Number","process","env","__NEXT_CLIENT_ROUTER_DYNAMIC_STALETIME","getStaleTimeMs","__NEXT_CLIENT_ROUTER_STATIC_STALETIME","state","action","url","isExternalUrl","navigateType","shouldScroll","completeHardNavigation","document","getElementById","currentUrl","URL","canonicalUrl","location","origin","currentRenderedSearch","renderedSearch","navigateUsingSegmentCache","cache","tree","nextUrl","FreshnessPolicy","Default"],"mappings":";;;;;;;;;;;;;;;;IAeaA,oBAAoB;eAApBA;;IAGAC,mBAAmB;eAAnBA;;IAIGC,eAAe;eAAfA;;;4BAbT;uBACwB;gCACC;AAIzB,MAAMF,uBACXG,OAAOC,QAAQC,GAAG,CAACC,sCAAsC,IAAI;AAExD,MAAML,sBAAsBM,IAAAA,qBAAc,EAC/CJ,OAAOC,QAAQC,GAAG,CAACG,qCAAqC;AAGnD,SAASN,gBACdO,KAA2B,EAC3BC,MAAsB;IAEtB,MAAM,EAAEC,GAAG,EAAEC,aAAa,EAAEC,YAAY,EAAEC,YAAY,EAAE,GAAGJ;IAE3D,IAAIE,eAAe;QACjB,OAAOG,IAAAA,kCAAsB,EAACN,OAAOE,KAAKE;IAC5C;IAEA,mEAAmE;IACnE,wCAAwC;IACxC,IAAIG,SAASC,cAAc,CAAC,yBAAyB;QACnD,OAAOF,IAAAA,kCAAsB,EAACN,OAAOE,KAAKE;IAC5C;IAEA,wEAAwE;IACxE,mEAAmE;IACnE,iBAAiB;IACjB,MAAMK,aAAa,IAAIC,IAAIV,MAAMW,YAAY,EAAEC,SAASC,MAAM;IAC9D,MAAMC,wBAAwBd,MAAMe,cAAc;IAClD,OAAOC,IAAAA,oBAAyB,EAC9BhB,OACAE,KACAO,YACAK,uBACAd,MAAMiB,KAAK,EACXjB,MAAMkB,IAAI,EACVlB,MAAMmB,OAAO,EACbC,+BAAe,CAACC,OAAO,EACvBhB,cACAD;AAEJ","ignoreList":[0]}