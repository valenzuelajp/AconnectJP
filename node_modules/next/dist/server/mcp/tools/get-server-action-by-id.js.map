{"version":3,"sources":["../../../../src/server/mcp/tools/get-server-action-by-id.ts"],"sourcesContent":["import type { McpServer } from 'next/dist/compiled/@modelcontextprotocol/sdk/server/mcp'\nimport { z } from 'next/dist/compiled/zod'\nimport { promises as fs } from 'fs'\nimport { join } from 'path'\nimport { mcpTelemetryTracker } from '../mcp-telemetry-tracker'\n\nconst INLINE_ACTION_PREFIX = '$$RSC_SERVER_ACTION_'\n\ninterface ActionEntry {\n  workers?: Record<string, any>\n  layer?: Record<string, string>\n  filename: string\n  exportedName: string\n}\n\ninterface ServerReferenceManifest {\n  node: Record<string, ActionEntry>\n  edge: Record<string, ActionEntry>\n  encryptionKey: string\n}\n\nexport function registerGetActionByIdTool(server: McpServer, distDir: string) {\n  server.registerTool(\n    'get_server_action_by_id',\n    {\n      description:\n        'Locates a Server Action by its ID in the server-reference-manifest.json. Returns the filename and export name for the action.',\n      inputSchema: {\n        actionId: z.string(),\n      },\n    },\n    async (request) => {\n      // Track telemetry\n      mcpTelemetryTracker.recordToolCall('mcp/get_server_action_by_id')\n\n      try {\n        const { actionId } = request\n\n        if (!actionId) {\n          return {\n            content: [\n              {\n                type: 'text',\n                text: JSON.stringify({\n                  error: 'actionId parameter is required',\n                }),\n              },\n            ],\n          }\n        }\n\n        const manifestPath = join(\n          distDir,\n          'server',\n          'server-reference-manifest.json'\n        )\n\n        let manifestContent: string\n        try {\n          manifestContent = await fs.readFile(manifestPath, 'utf-8')\n        } catch (error) {\n          return {\n            content: [\n              {\n                type: 'text',\n                text: JSON.stringify({\n                  error: `Could not read server-reference-manifest.json at ${manifestPath}.`,\n                }),\n              },\n            ],\n          }\n        }\n\n        const manifest: ServerReferenceManifest = JSON.parse(manifestContent)\n\n        // Search in node entries\n        if (manifest.node && manifest.node[actionId]) {\n          const entry = manifest.node[actionId]\n          const isInlineAction =\n            entry.exportedName.startsWith(INLINE_ACTION_PREFIX)\n          return {\n            content: [\n              {\n                type: 'text',\n                text: JSON.stringify(\n                  {\n                    actionId,\n                    runtime: 'node',\n                    filename: entry.filename,\n                    functionName: isInlineAction\n                      ? 'inline server action'\n                      : entry.exportedName,\n                    layer: entry.layer,\n                    workers: entry.workers,\n                  },\n                  null,\n                  2\n                ),\n              },\n            ],\n          }\n        }\n\n        // Search in edge entries\n        if (manifest.edge && manifest.edge[actionId]) {\n          const entry = manifest.edge[actionId]\n          const isInlineAction =\n            entry.exportedName.startsWith(INLINE_ACTION_PREFIX)\n          return {\n            content: [\n              {\n                type: 'text',\n                text: JSON.stringify(\n                  {\n                    actionId,\n                    runtime: 'edge',\n                    filename: entry.filename,\n                    functionName: isInlineAction\n                      ? 'inline server action'\n                      : entry.exportedName,\n                    layer: entry.layer,\n                    workers: entry.workers,\n                  },\n                  null,\n                  2\n                ),\n              },\n            ],\n          }\n        }\n\n        return {\n          content: [\n            {\n              type: 'text',\n              text: JSON.stringify({\n                error: `Action ID \"${actionId}\" not found in server-reference-manifest.json`,\n              }),\n            },\n          ],\n        }\n      } catch (error) {\n        return {\n          content: [\n            {\n              type: 'text',\n              text: JSON.stringify({\n                error: error instanceof Error ? error.message : String(error),\n              }),\n            },\n          ],\n        }\n      }\n    }\n  )\n}\n"],"names":["registerGetActionByIdTool","INLINE_ACTION_PREFIX","server","distDir","registerTool","description","inputSchema","actionId","z","string","request","mcpTelemetryTracker","recordToolCall","content","type","text","JSON","stringify","error","manifestPath","join","manifestContent","fs","readFile","manifest","parse","node","entry","isInlineAction","exportedName","startsWith","runtime","filename","functionName","layer","workers","edge","Error","message","String"],"mappings":";;;;+BAqBgBA;;;eAAAA;;;qBApBE;oBACa;sBACV;qCACe;AAEpC,MAAMC,uBAAuB;AAetB,SAASD,0BAA0BE,MAAiB,EAAEC,OAAe;IAC1ED,OAAOE,YAAY,CACjB,2BACA;QACEC,aACE;QACFC,aAAa;YACXC,UAAUC,MAAC,CAACC,MAAM;QACpB;IACF,GACA,OAAOC;QACL,kBAAkB;QAClBC,wCAAmB,CAACC,cAAc,CAAC;QAEnC,IAAI;YACF,MAAM,EAAEL,QAAQ,EAAE,GAAGG;YAErB,IAAI,CAACH,UAAU;gBACb,OAAO;oBACLM,SAAS;wBACP;4BACEC,MAAM;4BACNC,MAAMC,KAAKC,SAAS,CAAC;gCACnBC,OAAO;4BACT;wBACF;qBACD;gBACH;YACF;YAEA,MAAMC,eAAeC,IAAAA,UAAI,EACvBjB,SACA,UACA;YAGF,IAAIkB;YACJ,IAAI;gBACFA,kBAAkB,MAAMC,YAAE,CAACC,QAAQ,CAACJ,cAAc;YACpD,EAAE,OAAOD,OAAO;gBACd,OAAO;oBACLL,SAAS;wBACP;4BACEC,MAAM;4BACNC,MAAMC,KAAKC,SAAS,CAAC;gCACnBC,OAAO,CAAC,iDAAiD,EAAEC,aAAa,CAAC,CAAC;4BAC5E;wBACF;qBACD;gBACH;YACF;YAEA,MAAMK,WAAoCR,KAAKS,KAAK,CAACJ;YAErD,yBAAyB;YACzB,IAAIG,SAASE,IAAI,IAAIF,SAASE,IAAI,CAACnB,SAAS,EAAE;gBAC5C,MAAMoB,QAAQH,SAASE,IAAI,CAACnB,SAAS;gBACrC,MAAMqB,iBACJD,MAAME,YAAY,CAACC,UAAU,CAAC7B;gBAChC,OAAO;oBACLY,SAAS;wBACP;4BACEC,MAAM;4BACNC,MAAMC,KAAKC,SAAS,CAClB;gCACEV;gCACAwB,SAAS;gCACTC,UAAUL,MAAMK,QAAQ;gCACxBC,cAAcL,iBACV,yBACAD,MAAME,YAAY;gCACtBK,OAAOP,MAAMO,KAAK;gCAClBC,SAASR,MAAMQ,OAAO;4BACxB,GACA,MACA;wBAEJ;qBACD;gBACH;YACF;YAEA,yBAAyB;YACzB,IAAIX,SAASY,IAAI,IAAIZ,SAASY,IAAI,CAAC7B,SAAS,EAAE;gBAC5C,MAAMoB,QAAQH,SAASY,IAAI,CAAC7B,SAAS;gBACrC,MAAMqB,iBACJD,MAAME,YAAY,CAACC,UAAU,CAAC7B;gBAChC,OAAO;oBACLY,SAAS;wBACP;4BACEC,MAAM;4BACNC,MAAMC,KAAKC,SAAS,CAClB;gCACEV;gCACAwB,SAAS;gCACTC,UAAUL,MAAMK,QAAQ;gCACxBC,cAAcL,iBACV,yBACAD,MAAME,YAAY;gCACtBK,OAAOP,MAAMO,KAAK;gCAClBC,SAASR,MAAMQ,OAAO;4BACxB,GACA,MACA;wBAEJ;qBACD;gBACH;YACF;YAEA,OAAO;gBACLtB,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAMC,KAAKC,SAAS,CAAC;4BACnBC,OAAO,CAAC,WAAW,EAAEX,SAAS,6CAA6C,CAAC;wBAC9E;oBACF;iBACD;YACH;QACF,EAAE,OAAOW,OAAO;YACd,OAAO;gBACLL,SAAS;oBACP;wBACEC,MAAM;wBACNC,MAAMC,KAAKC,SAAS,CAAC;4BACnBC,OAAOA,iBAAiBmB,QAAQnB,MAAMoB,OAAO,GAAGC,OAAOrB;wBACzD;oBACF;iBACD;YACH;QACF;IACF;AAEJ","ignoreList":[0]}