{"version":3,"sources":["../../src/cli/next-dev.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport '../server/lib/cpu-profile'\nimport { saveCpuProfile } from '../server/lib/cpu-profile'\nimport type { StartServerOptions } from '../server/lib/start-server'\nimport {\n  RESTART_EXIT_CODE,\n  getNodeDebugType,\n  getParsedDebugAddress,\n  getMaxOldSpaceSize,\n  printAndExit,\n  formatNodeOptions,\n  formatDebugAddress,\n  getParsedNodeOptions,\n  type DebugAddress,\n} from '../server/lib/utils'\nimport * as Log from '../build/output/log'\nimport { getProjectDir } from '../lib/get-project-dir'\nimport path from 'path'\nimport { traceGlobals } from '../trace/shared'\nimport { Telemetry } from '../telemetry/storage'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport { fileExists, FileType } from '../lib/file-exists'\nimport { getNpxCommand } from '../lib/helpers/get-npx-command'\nimport { createSelfSignedCertificate } from '../lib/mkcert'\nimport type { SelfSignedCertificate } from '../lib/mkcert'\nimport uploadTrace from '../trace/upload-trace'\nimport { initialEnv } from '@next/env'\nimport { fork } from 'child_process'\nimport type { ChildProcess } from 'child_process'\nimport {\n  getReservedPortExplanation,\n  isPortIsReserved,\n} from '../lib/helpers/get-reserved-port'\nimport os from 'os'\nimport { once } from 'node:events'\nimport { clearTimeout } from 'timers'\nimport { flushAllTraces, trace } from '../trace'\nimport { traceId } from '../trace/shared'\nimport { Bundler, parseBundlerArgs } from '../lib/bundler'\n\nexport type NextDevOptions = {\n  disableSourceMaps: boolean\n  // Commander is not putting `--inspect` through the arg parser\n  inspect?: DebugAddress | true\n  turbo?: boolean\n  turbopack?: boolean\n  webpack?: boolean\n  port: number\n  hostname?: string\n  experimentalHttps?: boolean\n  experimentalHttpsKey?: string\n  experimentalHttpsCert?: string\n  experimentalHttpsCa?: string\n  experimentalUploadTrace?: string\n  experimentalNextConfigStripTypes?: boolean\n  experimentalCpuProf?: boolean\n}\n\ntype PortSource = 'cli' | 'default' | 'env'\n\nlet dir: string\nlet child: undefined | ChildProcess\n// distDir is received from the child process via IPC, used for telemetry and trace.\nlet distDir: string | undefined\nlet isTurbopack: boolean\nlet traceUploadUrl: string\nlet sessionStopHandled = false\nconst sessionStarted = Date.now()\nconst sessionSpan = trace('next-dev')\n\n// How long should we wait for the child to cleanly exit after sending\n// SIGINT/SIGTERM to the child process before sending SIGKILL?\nconst CHILD_EXIT_TIMEOUT_MS = parseInt(\n  process.env.NEXT_EXIT_TIMEOUT_MS ?? '100',\n  10\n)\n\nconst handleSessionStop = async (signal: NodeJS.Signals | number | null) => {\n  if (signal != null && child?.pid) child.kill(signal)\n  if (sessionStopHandled) return\n  sessionStopHandled = true\n\n  // Capture the child's exit code if it has already exited and caused the\n  // session stop (via the 'exit' event), otherwise assume success (0).\n  const exitCode = child?.exitCode || 0\n\n  if (\n    signal != null &&\n    child?.pid &&\n    child.exitCode === null &&\n    child.signalCode === null\n  ) {\n    let exitTimeout = setTimeout(() => {\n      child?.kill('SIGKILL')\n    }, CHILD_EXIT_TIMEOUT_MS)\n    await once(child, 'exit').catch(() => {})\n    clearTimeout(exitTimeout)\n  }\n\n  sessionSpan.stop()\n  await flushAllTraces({ end: true })\n\n  try {\n    const { eventCliSessionStopped } =\n      require('../telemetry/events/session-stopped') as typeof import('../telemetry/events/session-stopped')\n\n    let pagesDir: boolean = !!traceGlobals.get('pagesDir')\n    let appDir: boolean = !!traceGlobals.get('appDir')\n\n    if (\n      typeof traceGlobals.get('pagesDir') === 'undefined' ||\n      typeof traceGlobals.get('appDir') === 'undefined'\n    ) {\n      const pagesResult = findPagesDir(dir)\n      appDir = !!pagesResult.appDir\n      pagesDir = !!pagesResult.pagesDir\n    }\n\n    let telemetry =\n      (traceGlobals.get('telemetry') as InstanceType<\n        typeof import('../telemetry/storage').Telemetry\n      >) ||\n      new Telemetry({\n        distDir: path.join(dir, distDir || '.next'),\n      })\n\n    telemetry.record(\n      eventCliSessionStopped({\n        cliCommand: 'dev',\n        turboFlag: isTurbopack,\n        durationMilliseconds: Date.now() - sessionStarted,\n        pagesDir,\n        appDir,\n      }),\n      true\n    )\n    telemetry.flushDetached('dev', dir)\n  } catch (_) {\n    // errors here aren't actionable so don't add\n    // noise to the output\n  }\n\n  if (traceUploadUrl && distDir) {\n    uploadTrace({\n      traceUploadUrl,\n      mode: 'dev',\n      projectDir: dir,\n      distDir,\n      isTurboSession: isTurbopack,\n    })\n  }\n\n  // Save CPU profile if it was enabled (before exiting)\n  saveCpuProfile()\n\n  // ensure we re-enable the terminal cursor before exiting\n  // the program, or the cursor could remain hidden\n  process.stdout.write('\\x1B[?25h')\n  process.stdout.write('\\n')\n  process.exit(exitCode)\n}\n\nprocess.on('SIGINT', () => handleSessionStop('SIGINT'))\nprocess.on('SIGTERM', () => handleSessionStop('SIGTERM'))\n\n// exit event must be synchronous\nprocess.on('exit', () => child?.kill('SIGKILL'))\n\nconst nextDev = async (\n  options: NextDevOptions,\n  portSource: PortSource,\n  directory?: string\n) => {\n  // Note: parseBundlerArgs can only decide on Turbopack or webpack.\n  // Rspack can be configured via next.config.js but next.config.js is not loaded in the main process, only in the child process.\n  isTurbopack = parseBundlerArgs(options) === Bundler.Turbopack\n\n  dir = getProjectDir(process.env.NEXT_PRIVATE_DEV_DIR || directory)\n\n  // Check if pages dir exists and warn if not\n  if (!(await fileExists(dir, FileType.Directory))) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  if (options.experimentalCpuProf) {\n    Log.info(\n      `CPU profiling enabled. Profile will be saved to .next/cpu-profiles/ on exit (Ctrl+C).`\n    )\n  }\n\n  async function preflight(skipOnReboot: boolean) {\n    const { getPackageVersion, getDependencies } = (await Promise.resolve(\n      require('../lib/get-package-version') as typeof import('../lib/get-package-version')\n    )) as typeof import('../lib/get-package-version')\n\n    const [sassVersion, nodeSassVersion] = await Promise.all([\n      getPackageVersion({ cwd: dir, name: 'sass' }),\n      getPackageVersion({ cwd: dir, name: 'node-sass' }),\n    ])\n    if (sassVersion && nodeSassVersion) {\n      Log.warn(\n        'Your project has both `sass` and `node-sass` installed as dependencies, but should only use one or the other. ' +\n          'Please remove the `node-sass` dependency from your project. ' +\n          ' Read more: https://nextjs.org/docs/messages/duplicate-sass'\n      )\n    }\n\n    if (!skipOnReboot) {\n      const { dependencies, devDependencies } = await getDependencies({\n        cwd: dir,\n      })\n\n      // Warn if @next/font is installed as a dependency. Ignore `workspace:*` to not warn in the Next.js monorepo.\n      if (\n        dependencies['@next/font'] ||\n        (devDependencies['@next/font'] &&\n          devDependencies['@next/font'] !== 'workspace:*')\n      ) {\n        const command = getNpxCommand(dir)\n        Log.warn(\n          'Your project has `@next/font` installed as a dependency, please use the built-in `next/font` instead. ' +\n            'The `@next/font` package will be removed in Next.js 14. ' +\n            `You can migrate by running \\`${command} @next/codemod@latest built-in-next-font .\\`. Read more: https://nextjs.org/docs/messages/built-in-next-font`\n        )\n      }\n    }\n  }\n\n  let port = options.port\n\n  if (isPortIsReserved(port)) {\n    printAndExit(getReservedPortExplanation(port), 1)\n  }\n\n  // If neither --port nor PORT were specified, it's okay to retry new ports.\n  const allowRetry = portSource === 'default'\n\n  // We do not set a default host value here to prevent breaking\n  // some set-ups that rely on listening on other interfaces\n  const host = options.hostname\n\n  if (\n    options.experimentalUploadTrace &&\n    !process.env.NEXT_TRACE_UPLOAD_DISABLED\n  ) {\n    traceUploadUrl = options.experimentalUploadTrace\n  }\n\n  const devServerOptions: StartServerOptions = {\n    dir,\n    port,\n    allowRetry,\n    isDev: true,\n    hostname: host,\n  }\n\n  const startServerPath = require.resolve('../server/lib/start-server')\n\n  async function startServer(startServerOptions: StartServerOptions) {\n    return new Promise<void>((resolve) => {\n      let resolved = false\n      const defaultEnv = (initialEnv || process.env) as typeof process.env\n\n      const nodeOptions = getParsedNodeOptions()\n\n      let maxOldSpaceSize: string | number | undefined = getMaxOldSpaceSize()\n      if (!maxOldSpaceSize && !process.env.NEXT_DISABLE_MEM_OVERRIDE) {\n        const totalMem = os.totalmem()\n        const totalMemInMB = Math.floor(totalMem / 1024 / 1024)\n        maxOldSpaceSize = Math.floor(totalMemInMB * 0.5).toString()\n\n        nodeOptions['max-old-space-size'] = maxOldSpaceSize\n\n        // Ensure the max_old_space_size is not also set.\n        delete nodeOptions['max_old_space_size']\n      }\n\n      if (options.disableSourceMaps) {\n        delete nodeOptions['enable-source-maps']\n      } else {\n        nodeOptions['enable-source-maps'] = true\n      }\n\n      const nodeDebugType = getNodeDebugType(nodeOptions)\n      const originalAddress =\n        nodeDebugType === undefined ? undefined : nodeOptions[nodeDebugType]\n      delete nodeOptions.inspect\n      delete nodeOptions['inspect-brk']\n      delete nodeOptions['inspect_brk']\n      if (nodeDebugType !== undefined) {\n        const address = getParsedDebugAddress(originalAddress)\n        address.port = address.port === 0 ? 0 : address.port + 1\n        nodeOptions[nodeDebugType] = formatDebugAddress(address)\n      } else if (options.inspect) {\n        const address: DebugAddress =\n          options.inspect === true\n            ? getParsedDebugAddress(true)\n            : options.inspect\n        nodeOptions.inspect = formatDebugAddress(address)\n      }\n\n      child = fork(startServerPath, {\n        stdio: 'inherit',\n        env: {\n          ...defaultEnv,\n          ...(isTurbopack ? { TURBOPACK: process.env.TURBOPACK } : undefined),\n          NEXT_PRIVATE_START_TIME: process.env.NEXT_PRIVATE_START_TIME,\n          NEXT_PRIVATE_WORKER: '1',\n          NEXT_PRIVATE_TRACE_ID: traceId,\n          NODE_EXTRA_CA_CERTS: startServerOptions.selfSignedCertificate\n            ? startServerOptions.selfSignedCertificate.rootCA\n            : defaultEnv.NODE_EXTRA_CA_CERTS,\n          NODE_OPTIONS: formatNodeOptions(nodeOptions),\n          // There is a node.js bug on MacOS which causes closing file watchers to be really slow.\n          // This limits the number of watchers to mitigate the issue.\n          // https://github.com/nodejs/node/issues/29949\n          WATCHPACK_WATCHER_LIMIT:\n            os.platform() === 'darwin' ? '20' : undefined,\n          // Enable CPU profiling if requested\n          ...(options.experimentalCpuProf\n            ? {\n                NEXT_CPU_PROF: '1',\n                NEXT_CPU_PROF_DIR: path.join(dir, '.next', 'cpu-profiles'),\n                __NEXT_PRIVATE_CPU_PROFILE: 'dev-server',\n              }\n            : undefined),\n        },\n      })\n\n      child.on('message', (msg: any) => {\n        if (msg && typeof msg === 'object') {\n          if (msg.nextWorkerReady) {\n            child?.send({ nextWorkerOptions: startServerOptions })\n          } else if (msg.nextServerReady && !resolved) {\n            if (msg.port) {\n              // Store the used port in case a random one was selected, so that\n              // it can be re-used on automatic dev server restarts.\n              port = parseInt(msg.port, 10)\n            }\n            if (msg.distDir) {\n              // Store the distDir from the child process for telemetry and trace uploads.\n              distDir = msg.distDir\n            }\n\n            resolved = true\n            resolve()\n          }\n        }\n      })\n\n      child.on('exit', async (code, signal) => {\n        if (sessionStopHandled || signal) {\n          return\n        }\n        if (code === RESTART_EXIT_CODE) {\n          // Starting the dev server will overwrite the `.next/trace` file, so we\n          // must upload the existing contents before restarting the server to\n          // preserve the metrics.\n          if (traceUploadUrl && distDir) {\n            uploadTrace({\n              traceUploadUrl,\n              mode: 'dev',\n              projectDir: dir,\n              distDir,\n              isTurboSession: isTurbopack,\n              sync: true,\n            })\n          }\n\n          return startServer({ ...startServerOptions, port })\n        }\n        // Call handler (e.g. upload telemetry). Don't try to send a signal to\n        // the child, as it has already exited.\n        await handleSessionStop(/* signal */ null)\n      })\n    })\n  }\n\n  const runDevServer = async (reboot: boolean) => {\n    try {\n      if (!!options.experimentalHttps) {\n        Log.warn(\n          'Self-signed certificates are currently an experimental feature, use with caution.'\n        )\n\n        let certificate: SelfSignedCertificate | undefined\n\n        const key = options.experimentalHttpsKey\n        const cert = options.experimentalHttpsCert\n        const rootCA = options.experimentalHttpsCa\n\n        if (key && cert) {\n          certificate = {\n            key: path.resolve(key),\n            cert: path.resolve(cert),\n            rootCA: rootCA ? path.resolve(rootCA) : undefined,\n          }\n        } else {\n          certificate = await createSelfSignedCertificate(host)\n        }\n\n        await startServer({\n          ...devServerOptions,\n          selfSignedCertificate: certificate,\n        })\n      } else {\n        await startServer(devServerOptions)\n      }\n\n      await preflight(reboot)\n    } catch (err) {\n      console.error(err)\n      process.exit(1)\n    }\n  }\n\n  await runDevServer(false)\n}\n\nexport { nextDev }\n"],"names":["nextDev","dir","child","distDir","isTurbopack","traceUploadUrl","sessionStopHandled","sessionStarted","Date","now","sessionSpan","trace","CHILD_EXIT_TIMEOUT_MS","parseInt","process","env","NEXT_EXIT_TIMEOUT_MS","handleSessionStop","signal","pid","kill","exitCode","signalCode","exitTimeout","setTimeout","once","catch","clearTimeout","stop","flushAllTraces","end","eventCliSessionStopped","require","pagesDir","traceGlobals","get","appDir","pagesResult","findPagesDir","telemetry","Telemetry","path","join","record","cliCommand","turboFlag","durationMilliseconds","flushDetached","_","uploadTrace","mode","projectDir","isTurboSession","saveCpuProfile","stdout","write","exit","on","options","portSource","directory","parseBundlerArgs","Bundler","Turbopack","getProjectDir","NEXT_PRIVATE_DEV_DIR","fileExists","FileType","Directory","printAndExit","experimentalCpuProf","Log","info","preflight","skipOnReboot","getPackageVersion","getDependencies","Promise","resolve","sassVersion","nodeSassVersion","all","cwd","name","warn","dependencies","devDependencies","command","getNpxCommand","port","isPortIsReserved","getReservedPortExplanation","allowRetry","host","hostname","experimentalUploadTrace","NEXT_TRACE_UPLOAD_DISABLED","devServerOptions","isDev","startServerPath","startServer","startServerOptions","resolved","defaultEnv","initialEnv","nodeOptions","getParsedNodeOptions","maxOldSpaceSize","getMaxOldSpaceSize","NEXT_DISABLE_MEM_OVERRIDE","totalMem","os","totalmem","totalMemInMB","Math","floor","toString","disableSourceMaps","nodeDebugType","getNodeDebugType","originalAddress","undefined","inspect","address","getParsedDebugAddress","formatDebugAddress","fork","stdio","TURBOPACK","NEXT_PRIVATE_START_TIME","NEXT_PRIVATE_WORKER","NEXT_PRIVATE_TRACE_ID","traceId","NODE_EXTRA_CA_CERTS","selfSignedCertificate","rootCA","NODE_OPTIONS","formatNodeOptions","WATCHPACK_WATCHER_LIMIT","platform","NEXT_CPU_PROF","NEXT_CPU_PROF_DIR","__NEXT_PRIVATE_CPU_PROFILE","msg","nextWorkerReady","send","nextWorkerOptions","nextServerReady","code","RESTART_EXIT_CODE","sync","runDevServer","reboot","experimentalHttps","certificate","key","experimentalHttpsKey","cert","experimentalHttpsCert","experimentalHttpsCa","createSelfSignedCertificate","err","console","error"],"mappings":"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","ignoreList":[0]}