{"version":3,"sources":["../../src/cli/next-start.ts"],"sourcesContent":["#!/usr/bin/env node\n\n// Ensure NEXT_PRIVATE_START_TIME is set for accurate \"Ready in\" timing.\n// This should already be set by bin/next.ts, but we set it here as a fallback\n// in case the module is loaded through a different code path.\nif (!process.env.NEXT_PRIVATE_START_TIME) {\n  process.env.NEXT_PRIVATE_START_TIME = Date.now().toString()\n}\n\nimport '../server/lib/cpu-profile'\nimport { saveCpuProfile } from '../server/lib/cpu-profile'\nimport { startServer } from '../server/lib/start-server'\nimport {\n  getParsedDebugAddress,\n  formatDebugAddress,\n  printAndExit,\n  type DebugAddress,\n} from '../server/lib/utils'\nimport { getProjectDir } from '../lib/get-project-dir'\nimport {\n  getReservedPortExplanation,\n  isPortIsReserved,\n} from '../lib/helpers/get-reserved-port'\nimport * as Log from '../build/output/log'\n\nexport type NextStartOptions = {\n  port: number\n  hostname?: string\n  // Commander is not putting `--inspect` through the arg parser\n  inspect?: DebugAddress | true\n  keepAliveTimeout?: number\n  experimentalNextConfigStripTypes?: boolean\n  experimentalCpuProf?: boolean\n}\n\n/**\n * Start the Next.js server\n *\n * @param options The options for the start command\n * @param directory The directory to start the server in\n */\nconst nextStart = async (options: NextStartOptions, directory?: string) => {\n  const dir = getProjectDir(directory)\n  const hostname = options.hostname\n  const inspect = options.inspect\n  const port = options.port\n  const keepAliveTimeout = options.keepAliveTimeout\n\n  if (isPortIsReserved(port)) {\n    printAndExit(getReservedPortExplanation(port), 1)\n  }\n\n  if (inspect) {\n    const inspector = await import('inspector')\n    const isInspecting = inspector.url() !== undefined\n    if (isInspecting) {\n      Log.warn(\n        `The Node.js debugger port is already open at ${process.debugPort}. Ignoring '--inspect${inspect === true ? '' : `=\"${formatDebugAddress(inspect)}\"`}'.`\n      )\n    } else {\n      const inspectAddress: DebugAddress =\n        inspect === true ? getParsedDebugAddress(true) : inspect\n      // TODO: Implement --inspect-wait\n      const wait = false\n      try {\n        inspector.open(inspectAddress.port, inspectAddress.host, wait)\n      } catch (error) {\n        console.error(\n          `Failed to start the Node.js inspector with --inspect=\"${formatDebugAddress(inspectAddress)}\":`,\n          error\n        )\n        return process.exit(1)\n      }\n    }\n  }\n\n  if (options.experimentalCpuProf) {\n    Log.info(`CPU profiling enabled. Profile will be saved on exit (Ctrl+C).`)\n    // Save CPU profile on shutdown signals, but let start-server.ts handle graceful exit\n    process.on('SIGTERM', () => saveCpuProfile())\n    process.on('SIGINT', () => saveCpuProfile())\n  }\n\n  await startServer({\n    dir,\n    isDev: false,\n    hostname,\n    port,\n    keepAliveTimeout,\n  })\n}\n\nexport { nextStart }\n"],"names":["nextStart","process","env","NEXT_PRIVATE_START_TIME","Date","now","toString","options","directory","dir","getProjectDir","hostname","inspect","port","keepAliveTimeout","isPortIsReserved","printAndExit","getReservedPortExplanation","inspector","isInspecting","url","undefined","Log","warn","debugPort","formatDebugAddress","inspectAddress","getParsedDebugAddress","wait","open","host","error","console","exit","experimentalCpuProf","info","on","saveCpuProfile","startServer","isDev"],"mappings":";;;;;+BA4FSA;;;eAAAA;;;4BAnFF;6BAEqB;uBAMrB;+BACuB;iCAIvB;6DACc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AArBrB,wEAAwE;AACxE,8EAA8E;AAC9E,8DAA8D;AAC9D,IAAI,CAACC,QAAQC,GAAG,CAACC,uBAAuB,EAAE;IACxCF,QAAQC,GAAG,CAACC,uBAAuB,GAAGC,KAAKC,GAAG,GAAGC,QAAQ;AAC3D;AA4BA;;;;;CAKC,GACD,MAAMN,YAAY,OAAOO,SAA2BC;IAClD,MAAMC,MAAMC,IAAAA,4BAAa,EAACF;IAC1B,MAAMG,WAAWJ,QAAQI,QAAQ;IACjC,MAAMC,UAAUL,QAAQK,OAAO;IAC/B,MAAMC,OAAON,QAAQM,IAAI;IACzB,MAAMC,mBAAmBP,QAAQO,gBAAgB;IAEjD,IAAIC,IAAAA,iCAAgB,EAACF,OAAO;QAC1BG,IAAAA,mBAAY,EAACC,IAAAA,2CAA0B,EAACJ,OAAO;IACjD;IAEA,IAAID,SAAS;QACX,MAAMM,YAAY,MAAM,MAAM,CAAC;QAC/B,MAAMC,eAAeD,UAAUE,GAAG,OAAOC;QACzC,IAAIF,cAAc;YAChBG,KAAIC,IAAI,CACN,CAAC,6CAA6C,EAAEtB,QAAQuB,SAAS,CAAC,qBAAqB,EAAEZ,YAAY,OAAO,KAAK,CAAC,EAAE,EAAEa,IAAAA,yBAAkB,EAACb,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC;QAE5J,OAAO;YACL,MAAMc,iBACJd,YAAY,OAAOe,IAAAA,4BAAqB,EAAC,QAAQf;YACnD,iCAAiC;YACjC,MAAMgB,OAAO;YACb,IAAI;gBACFV,UAAUW,IAAI,CAACH,eAAeb,IAAI,EAAEa,eAAeI,IAAI,EAAEF;YAC3D,EAAE,OAAOG,OAAO;gBACdC,QAAQD,KAAK,CACX,CAAC,sDAAsD,EAAEN,IAAAA,yBAAkB,EAACC,gBAAgB,EAAE,CAAC,EAC/FK;gBAEF,OAAO9B,QAAQgC,IAAI,CAAC;YACtB;QACF;IACF;IAEA,IAAI1B,QAAQ2B,mBAAmB,EAAE;QAC/BZ,KAAIa,IAAI,CAAC,CAAC,8DAA8D,CAAC;QACzE,qFAAqF;QACrFlC,QAAQmC,EAAE,CAAC,WAAW,IAAMC,IAAAA,0BAAc;QAC1CpC,QAAQmC,EAAE,CAAC,UAAU,IAAMC,IAAAA,0BAAc;IAC3C;IAEA,MAAMC,IAAAA,wBAAW,EAAC;QAChB7B;QACA8B,OAAO;QACP5B;QACAE;QACAC;IACF;AACF","ignoreList":[0]}