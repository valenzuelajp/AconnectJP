{"version":3,"sources":["../../../src/lib/typescript/writeAppTypeDeclarations.ts"],"sourcesContent":["import os from 'os'\nimport path from 'path'\nimport { promises as fs } from 'fs'\n\nexport async function writeAppTypeDeclarations({\n  baseDir,\n  distDir,\n  distDirRoot,\n  imageImportsEnabled,\n  hasPagesDir,\n  hasAppDir,\n}: {\n  baseDir: string\n  distDir: string\n  /** The root dist directory without /dev suffix, used for fixed type paths */\n  distDirRoot?: string\n  imageImportsEnabled: boolean\n  hasPagesDir: boolean\n  hasAppDir: boolean\n}): Promise<void> {\n  // Use distDirRoot for fixed paths in next-env.d.ts, fallback to distDir\n  const typesDistDir = distDirRoot ?? distDir\n  // Reference `next` types\n  const appTypeDeclarations = path.join(baseDir, 'next-env.d.ts')\n\n  // Defaults EOL to system default\n  let eol = os.EOL\n  let currentContent: string | undefined\n\n  try {\n    currentContent = await fs.readFile(appTypeDeclarations, 'utf8')\n    // If file already exists then preserve its line ending\n    const lf = currentContent.indexOf('\\n', /* skip first so we can lf - 1 */ 1)\n\n    if (lf !== -1) {\n      if (currentContent[lf - 1] === '\\r') {\n        eol = '\\r\\n'\n      } else {\n        eol = '\\n'\n      }\n    }\n  } catch {}\n\n  /**\n   * \"Triple-slash directives\" used to create typings files for Next.js projects\n   * using Typescript .\n   *\n   * @see https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html\n   */\n  const lines: string[] = [\n    // Include the core Next.js typings.\n    '/// <reference types=\"next\" />',\n  ]\n\n  if (imageImportsEnabled) {\n    lines.push('/// <reference types=\"next/image-types/global\" />')\n  }\n\n  if (hasAppDir && hasPagesDir) {\n    lines.push(\n      '/// <reference types=\"next/navigation-types/compat/navigation\" />'\n    )\n  }\n\n  // Use fixed path for the entry type file (always at .next/types/routes.d.ts)\n  // This entry file re-exports from actual type files which may be at different paths\n  const routeTypesPath = path.posix.join(\n    typesDistDir.replaceAll(path.win32.sep, path.posix.sep),\n    'types/routes.d.ts'\n  )\n\n  // Use ESM import instead of triple-slash reference for better ESLint compatibility\n  lines.push(`import \"./${routeTypesPath}\";`)\n\n  // Push the notice in.\n  lines.push(\n    '',\n    '// NOTE: This file should not be edited',\n    `// see https://nextjs.org/docs/${hasAppDir ? 'app' : 'pages'}/api-reference/config/typescript for more information.`\n  )\n\n  const content = lines.join(eol) + eol\n\n  // Avoids an un-necessary write on read-only fs\n  if (currentContent === content) {\n    return\n  }\n  await fs.writeFile(appTypeDeclarations, content)\n}\n"],"names":["writeAppTypeDeclarations","baseDir","distDir","distDirRoot","imageImportsEnabled","hasPagesDir","hasAppDir","typesDistDir","appTypeDeclarations","path","join","eol","os","EOL","currentContent","fs","readFile","lf","indexOf","lines","push","routeTypesPath","posix","replaceAll","win32","sep","content","writeFile"],"mappings":";;;;+BAIsBA;;;eAAAA;;;2DAJP;6DACE;oBACc;;;;;;AAExB,eAAeA,yBAAyB,EAC7CC,OAAO,EACPC,OAAO,EACPC,WAAW,EACXC,mBAAmB,EACnBC,WAAW,EACXC,SAAS,EASV;IACC,wEAAwE;IACxE,MAAMC,eAAeJ,eAAeD;IACpC,yBAAyB;IACzB,MAAMM,sBAAsBC,aAAI,CAACC,IAAI,CAACT,SAAS;IAE/C,iCAAiC;IACjC,IAAIU,MAAMC,WAAE,CAACC,GAAG;IAChB,IAAIC;IAEJ,IAAI;QACFA,iBAAiB,MAAMC,YAAE,CAACC,QAAQ,CAACR,qBAAqB;QACxD,uDAAuD;QACvD,MAAMS,KAAKH,eAAeI,OAAO,CAAC,MAAM,+BAA+B,GAAG;QAE1E,IAAID,OAAO,CAAC,GAAG;YACb,IAAIH,cAAc,CAACG,KAAK,EAAE,KAAK,MAAM;gBACnCN,MAAM;YACR,OAAO;gBACLA,MAAM;YACR;QACF;IACF,EAAE,OAAM,CAAC;IAET;;;;;GAKC,GACD,MAAMQ,QAAkB;QACtB,oCAAoC;QACpC;KACD;IAED,IAAIf,qBAAqB;QACvBe,MAAMC,IAAI,CAAC;IACb;IAEA,IAAId,aAAaD,aAAa;QAC5Bc,MAAMC,IAAI,CACR;IAEJ;IAEA,6EAA6E;IAC7E,oFAAoF;IACpF,MAAMC,iBAAiBZ,aAAI,CAACa,KAAK,CAACZ,IAAI,CACpCH,aAAagB,UAAU,CAACd,aAAI,CAACe,KAAK,CAACC,GAAG,EAAEhB,aAAI,CAACa,KAAK,CAACG,GAAG,GACtD;IAGF,mFAAmF;IACnFN,MAAMC,IAAI,CAAC,CAAC,UAAU,EAAEC,eAAe,EAAE,CAAC;IAE1C,sBAAsB;IACtBF,MAAMC,IAAI,CACR,IACA,2CACA,CAAC,+BAA+B,EAAEd,YAAY,QAAQ,QAAQ,sDAAsD,CAAC;IAGvH,MAAMoB,UAAUP,MAAMT,IAAI,CAACC,OAAOA;IAElC,+CAA+C;IAC/C,IAAIG,mBAAmBY,SAAS;QAC9B;IACF;IACA,MAAMX,YAAE,CAACY,SAAS,CAACnB,qBAAqBkB;AAC1C","ignoreList":[0]}