{"version":3,"sources":["../../../../../src/server/lib/router-utils/setup-dev-bundler.ts"],"sourcesContent":["import type { NextConfigComplete } from '../../config-shared'\nimport type { FilesystemDynamicRoute } from './filesystem'\nimport type { UnwrapPromise } from '../../../lib/coalesced-function'\nimport type { ProxyMatcher } from '../../../build/analysis/get-page-static-info'\nimport type { RoutesManifest } from '../../../build'\nimport type { MiddlewareRouteMatch } from '../../../shared/lib/router/utils/middleware-route-matcher'\nimport type { PropagateToWorkersField } from './types'\nimport type { NextJsHotReloaderInterface } from '../../dev/hot-reloader-types'\n\nimport { createDefineEnv } from '../../../build/swc'\nimport { installBindings } from '../../../build/swc/install-bindings'\nimport fs from 'fs'\nimport path from 'path'\nimport qs from 'querystring'\nimport Watchpack from 'next/dist/compiled/watchpack'\nimport findUp from 'next/dist/compiled/find-up'\nimport { buildCustomRoute } from './filesystem'\nimport * as Log from '../../../build/output/log'\nimport { setGlobal } from '../../../trace/shared'\nimport type { Telemetry } from '../../../telemetry/storage'\nimport type { IncomingMessage, ServerResponse } from 'http'\nimport { createValidFileMatcher } from '../find-page-file'\nimport {\n  EVENT_BUILD_FEATURE_USAGE,\n  eventCliSession,\n} from '../../../telemetry/events'\nimport { getSortedRoutes } from '../../../shared/lib/router/utils'\nimport { sortByPageExts } from '../../../build/sort-by-page-exts'\nimport { verifyTypeScriptSetup } from '../../../lib/verify-typescript-setup'\nimport { verifyPartytownSetup } from '../../../lib/verify-partytown-setup'\nimport { getNamedRouteRegex } from '../../../shared/lib/router/utils/route-regex'\nimport { normalizeAppPath } from '../../../shared/lib/router/utils/app-paths'\nimport { buildDataRoute } from './build-data-route'\nimport { getRouteMatcher } from '../../../shared/lib/router/utils/route-matcher'\nimport { normalizePathSep } from '../../../shared/lib/page-path/normalize-path-sep'\nimport { createClientRouterFilter } from '../../../lib/create-client-router-filter'\nimport { absolutePathToPage } from '../../../shared/lib/page-path/absolute-path-to-page'\nimport { generateInterceptionRoutesRewrites } from '../../../lib/generate-interception-routes-rewrites'\n\nimport {\n  CLIENT_STATIC_FILES_PATH,\n  DEV_CLIENT_PAGES_MANIFEST,\n  DEV_CLIENT_MIDDLEWARE_MANIFEST,\n  PHASE_DEVELOPMENT_SERVER,\n  TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST,\n  ROUTES_MANIFEST,\n  PRERENDER_MANIFEST,\n} from '../../../shared/lib/constants'\n\nimport { getMiddlewareRouteMatcher } from '../../../shared/lib/router/utils/middleware-route-matcher'\n\nimport {\n  isMiddlewareFile,\n  NestedMiddlewareError,\n  isInstrumentationHookFile,\n  getPossibleMiddlewareFilenames,\n  getPossibleInstrumentationHookFilenames,\n} from '../../../build/utils'\nimport { devPageFiles } from '../../../build/webpack/plugins/next-types-plugin/shared'\nimport type { LazyRenderServerInstance } from '../router-server'\nimport { HMR_MESSAGE_SENT_TO_BROWSER } from '../../dev/hot-reloader-types'\nimport { PAGE_TYPES } from '../../../lib/page-types'\nimport { generateEncryptionKeyBase64 } from '../../app-render/encryption-utils-server'\nimport {\n  isMetadataRouteFile,\n  isStaticMetadataFile,\n} from '../../../lib/metadata/is-metadata-route'\nimport {\n  fillMetadataSegment,\n  normalizeMetadataPageToRoute,\n} from '../../../lib/metadata/get-metadata-route'\nimport { JsConfigPathsPlugin } from '../../../build/webpack/plugins/jsconfig-paths-plugin'\nimport { store as consoleStore } from '../../../build/output/store'\nimport {\n  isFileSystemCacheEnabledForDev,\n  ModuleBuildError,\n} from '../../../shared/lib/turbopack/utils'\nimport { getDefineEnv } from '../../../build/define-env'\nimport { TurbopackInternalError } from '../../../shared/lib/turbopack/internal-error'\nimport { normalizePath } from '../../../lib/normalize-path'\nimport {\n  JSON_CONTENT_TYPE_HEADER,\n  MIDDLEWARE_FILENAME,\n  PROXY_FILENAME,\n} from '../../../lib/constants'\nimport { parseUrl } from '../../../lib/url'\nimport {\n  createRouteTypesManifest,\n  writeRouteTypesManifest,\n  writeValidatorFile,\n  writeRouteTypesEntryFile,\n} from './route-types-utils'\nimport { writeCacheLifeTypes } from './cache-life-type-utils'\nimport { isParallelRouteSegment } from '../../../shared/lib/segment'\nimport { ensureLeadingSlash } from '../../../shared/lib/page-path/ensure-leading-slash'\nimport { Lockfile, type DevServerInfo } from '../../../build/lockfile'\nimport { deobfuscateText } from '../../../shared/lib/magic-identifier'\n\nexport type SetupOpts = {\n  renderServer: LazyRenderServerInstance\n  dir: string\n  turbo?: boolean\n  appDir?: string\n  pagesDir?: string\n  telemetry: Telemetry\n  isCustomServer?: boolean\n  fsChecker: UnwrapPromise<\n    ReturnType<typeof import('./filesystem').setupFsCheck>\n  >\n  nextConfig: NextConfigComplete\n  port: number\n  onDevServerCleanup: ((listener: () => Promise<void>) => void) | undefined\n  resetFetch: () => void\n}\n\nexport interface DevRoutesManifest {\n  version: number\n  caseSensitive: RoutesManifest['caseSensitive']\n  basePath: RoutesManifest['basePath']\n  rewrites: RoutesManifest['rewrites']\n  redirects: RoutesManifest['redirects']\n  headers: RoutesManifest['headers']\n  i18n: RoutesManifest['i18n']\n  skipProxyUrlNormalize: RoutesManifest['skipProxyUrlNormalize']\n}\n\nexport type ServerFields = {\n  actualMiddlewareFile?: string | undefined\n  actualInstrumentationHookFile?: string | undefined\n  appPathRoutes?: Record<string, string | string[]>\n  middleware?:\n    | {\n        page: string\n        match: MiddlewareRouteMatch\n        matchers?: ProxyMatcher[]\n      }\n    | undefined\n  hasAppNotFound?: boolean\n  interceptionRoutes?: ReturnType<\n    typeof import('./filesystem').buildCustomRoute\n  >[]\n  setIsrStatus?: (key: string, value: boolean | undefined) => void\n  resetFetch?: () => void\n}\n\nasync function verifyTypeScript(opts: SetupOpts) {\n  const verifyResult = await verifyTypeScriptSetup({\n    dir: opts.dir,\n    distDir: opts.nextConfig.distDir,\n    distDirRoot: opts.nextConfig.distDirRoot,\n    strictRouteTypes: Boolean(opts.nextConfig.experimental.strictRouteTypes),\n    typeCheckPreflight: false,\n    tsconfigPath: opts.nextConfig.typescript.tsconfigPath,\n    disableStaticImages: opts.nextConfig.images.disableStaticImages,\n    hasAppDir: !!opts.appDir,\n    hasPagesDir: !!opts.pagesDir,\n    appDir: opts.appDir,\n    pagesDir: opts.pagesDir,\n  })\n\n  if (verifyResult.version) {\n    return true\n  }\n  return false\n}\n\nexport async function propagateServerField(\n  opts: SetupOpts,\n  field: PropagateToWorkersField,\n  args: any\n) {\n  await opts.renderServer?.instance?.propagateServerField(opts.dir, field, args)\n}\n\nasync function startWatcher(\n  opts: SetupOpts & {\n    isSrcDir: boolean\n  }\n) {\n  const { nextConfig, appDir, pagesDir, dir, resetFetch } = opts\n  const { useFileSystemPublicRoutes } = nextConfig\n\n  const distDir = path.join(opts.dir, opts.nextConfig.distDir)\n\n  setGlobal('distDir', distDir)\n  setGlobal('phase', PHASE_DEVELOPMENT_SERVER)\n\n  let lockfile\n  if (opts.nextConfig.experimental.lockDistDir) {\n    fs.mkdirSync(distDir, { recursive: true })\n\n    // Create server info to store in the lockfile itself\n    // This allows other processes to discover the running server\n    const appUrl = `http://localhost:${opts.port}`\n    const serverInfo: DevServerInfo = {\n      pid: process.pid,\n      port: opts.port,\n      hostname: 'localhost',\n      appUrl,\n      startedAt: Date.now(),\n    }\n\n    lockfile = await Lockfile.acquireWithRetriesOrExit(\n      path.join(distDir, 'lock'),\n      'next dev',\n      true,\n      JSON.stringify(serverInfo),\n      opts.dir,\n      opts.nextConfig.distDir\n    )\n  }\n\n  const validFileMatcher = createValidFileMatcher(\n    nextConfig.pageExtensions,\n    appDir\n  )\n\n  const serverFields: ServerFields = {}\n\n  // Update logging state once based on next.config.js when initializing\n  consoleStore.setState({\n    logging: nextConfig.logging !== false,\n  })\n\n  const hotReloader: NextJsHotReloaderInterface = opts.turbo\n    ? await (async () => {\n        const createHotReloaderTurbopack = (\n          require('../../dev/hot-reloader-turbopack') as typeof import('../../dev/hot-reloader-turbopack')\n        ).createHotReloaderTurbopack\n        return await createHotReloaderTurbopack(\n          opts,\n          serverFields,\n          distDir,\n          resetFetch,\n          lockfile\n        )\n      })()\n    : await (async () => {\n        const HotReloader = process.env.NEXT_RSPACK\n          ? (\n              require('../../dev/hot-reloader-rspack') as typeof import('../../dev/hot-reloader-rspack')\n            ).default\n          : (\n              require('../../dev/hot-reloader-webpack') as typeof import('../../dev/hot-reloader-webpack')\n            ).default\n        return new HotReloader(opts.dir, {\n          isSrcDir: opts.isSrcDir,\n          appDir,\n          pagesDir,\n          distDir,\n          config: opts.nextConfig,\n          buildId: 'development',\n          encryptionKey: await generateEncryptionKeyBase64({\n            isBuild: false,\n            distDir,\n          }),\n          telemetry: opts.telemetry,\n          rewrites: opts.fsChecker.rewrites,\n          previewProps: opts.fsChecker.prerenderManifest.preview,\n          resetFetch,\n          lockfile,\n          onDevServerCleanup: opts.onDevServerCleanup,\n        })\n      })()\n\n  await hotReloader.start()\n\n  const distTypesDir = path.join(distDir, 'types')\n  await writeRouteTypesManifest(\n    {\n      appRoutes: {},\n      pageRoutes: {},\n      layoutRoutes: {},\n      appRouteHandlerRoutes: {},\n      redirectRoutes: {},\n      rewriteRoutes: {},\n      appPagePaths: new Set(),\n      pagesRouterPagePaths: new Set(),\n      layoutPaths: new Set(),\n      appRouteHandlers: new Set(),\n      pageApiRoutes: new Set(),\n      filePathToRoute: new Map(),\n    },\n    path.join(distTypesDir, 'route-types.d.ts'),\n    opts.nextConfig\n  )\n\n  // Write the entry file at {distDirRoot}/types/routes.d.ts for initial state\n  const initialEntryFilePath = path.join(\n    opts.dir,\n    opts.nextConfig.distDirRoot,\n    'types',\n    'routes.d.ts'\n  )\n  await writeRouteTypesEntryFile(initialEntryFilePath, distTypesDir, {\n    strictRouteTypes: Boolean(nextConfig.experimental.strictRouteTypes),\n    typedRoutes: Boolean(nextConfig.typedRoutes),\n  })\n\n  const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n  const routesManifest: DevRoutesManifest = {\n    version: 3,\n    caseSensitive: !!nextConfig.experimental.caseSensitiveRoutes,\n    basePath: nextConfig.basePath,\n    rewrites: opts.fsChecker.rewrites,\n    redirects: opts.fsChecker.redirects,\n    headers: opts.fsChecker.headers,\n    i18n: nextConfig.i18n || undefined,\n    skipProxyUrlNormalize: nextConfig.skipProxyUrlNormalize,\n  }\n  await fs.promises.writeFile(\n    routesManifestPath,\n    JSON.stringify(routesManifest)\n  )\n\n  const prerenderManifestPath = path.join(distDir, PRERENDER_MANIFEST)\n  await fs.promises.writeFile(\n    prerenderManifestPath,\n    JSON.stringify(opts.fsChecker.prerenderManifest, null, 2)\n  )\n\n  if (opts.nextConfig.experimental.nextScriptWorkers) {\n    await verifyPartytownSetup(\n      opts.dir,\n      path.join(distDir, CLIENT_STATIC_FILES_PATH)\n    )\n  }\n\n  opts.fsChecker.ensureCallback(async function ensure(item) {\n    if (item.type === 'appFile' || item.type === 'pageFile') {\n      await hotReloader.ensurePage({\n        clientOnly: false,\n        page: item.itemPath,\n        isApp: item.type === 'appFile',\n        definition: undefined,\n      })\n    }\n  })\n\n  let resolved = false\n  let prevSortedRoutes: string[] = []\n\n  await new Promise<void>(async (resolve, reject) => {\n    if (pagesDir) {\n      // Watchpack doesn't emit an event for an empty directory\n      fs.readdir(pagesDir, (_, files) => {\n        if (files?.length) {\n          return\n        }\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      })\n    }\n\n    const pages = pagesDir ? [pagesDir] : []\n    const app = appDir ? [appDir] : []\n    const directories = [...pages, ...app]\n\n    const rootDir = pagesDir || appDir\n    const files = [\n      ...getPossibleMiddlewareFilenames(\n        path.join(rootDir!, '..'),\n        nextConfig.pageExtensions\n      ),\n      ...getPossibleInstrumentationHookFilenames(\n        path.join(rootDir!, '..'),\n        nextConfig.pageExtensions\n      ),\n    ]\n    let nestedMiddleware: string[] = []\n\n    const envFiles = [\n      '.env.development.local',\n      '.env.local',\n      '.env.development',\n      '.env',\n    ].map((file) => path.join(dir, file))\n\n    files.push(...envFiles)\n\n    // tsconfig/jsconfig paths hot-reloading\n    const tsconfigPaths = [\n      path.join(dir, 'tsconfig.json'),\n      path.join(dir, 'jsconfig.json'),\n    ] as const\n    files.push(...tsconfigPaths)\n\n    const wp = new Watchpack({\n      // Watchpack default is 200ms which adds 200ms of dead time on bootup.\n      aggregateTimeout: 5, // Matches webpack-config.ts.\n      ignored: (pathname: string) => {\n        return (\n          !files.some((file) => file.startsWith(pathname)) &&\n          !directories.some(\n            (d) => pathname.startsWith(d) || d.startsWith(pathname)\n          )\n        )\n      },\n    })\n    const fileWatchTimes = new Map()\n    let enabledTypeScript = await verifyTypeScript(opts)\n    let previousClientRouterFilters: any\n    let previousConflictingPagePaths: Set<string> = new Set()\n\n    // Actual type files go to route-types.d.ts (not routes.d.ts)\n    // routes.d.ts is reserved for the entry file\n    const routeTypesFilePath = path.join(distDir, 'types', 'route-types.d.ts')\n    const validatorFilePath = path.join(distDir, 'types', 'validator.ts')\n\n    let initialWatchTime = performance.now() + performance.timeOrigin\n    wp.on('aggregated', async () => {\n      let writeEnvDefinitions = false\n      let typescriptStatusFromLastAggregation = enabledTypeScript\n      let middlewareMatchers: ProxyMatcher[] | undefined\n      const routedPages: string[] = []\n      const knownFiles = wp.getTimeInfoEntries()\n      const appPaths: Record<string, string[]> = {}\n      const pageNameSet = new Set<string>()\n      const conflictingAppPagePaths = new Set<string>()\n      const appPageFilePaths = new Map<string, string>()\n      const pagesPageFilePaths = new Map<string, string>()\n      const appRouteHandlers: Array<{ route: string; filePath: string }> = []\n      const pageApiRoutes: Array<{ route: string; filePath: string }> = []\n\n      const pageRoutes: Array<{ route: string; filePath: string }> = []\n      const appRoutes: Array<{ route: string; filePath: string }> = []\n      const layoutRoutes: Array<{ route: string; filePath: string }> = []\n      const slots: Array<{ name: string; parent: string }> = []\n\n      let envChange = false\n      let tsconfigChange = false\n      let conflictingPageChange = 0\n      let hasRootAppNotFound = false\n\n      const { appFiles, pageFiles, staticMetadataFiles } = opts.fsChecker\n\n      appFiles.clear()\n      pageFiles.clear()\n      staticMetadataFiles.clear()\n      devPageFiles.clear()\n\n      const sortedKnownFiles: string[] = [...knownFiles.keys()].sort(\n        sortByPageExts(nextConfig.pageExtensions)\n      )\n\n      let proxyFilePath: string | undefined\n      let middlewareFilePath: string | undefined\n\n      for (const fileName of sortedKnownFiles) {\n        if (\n          !files.includes(fileName) &&\n          !directories.some((d) => fileName.startsWith(d))\n        ) {\n          continue\n        }\n\n        const { name: fileBaseName, dir: fileDir } = path.parse(fileName)\n\n        const isAtConventionLevel =\n          fileDir === dir || fileDir === path.join(dir, 'src')\n\n        if (isAtConventionLevel && fileBaseName === MIDDLEWARE_FILENAME) {\n          middlewareFilePath = fileName\n        }\n        if (isAtConventionLevel && fileBaseName === PROXY_FILENAME) {\n          proxyFilePath = fileName\n        }\n\n        if (middlewareFilePath) {\n          if (proxyFilePath) {\n            const cwd = process.cwd()\n\n            throw new Error(\n              `Both ${MIDDLEWARE_FILENAME} file \"./${path.relative(cwd, middlewareFilePath)}\" and ${PROXY_FILENAME} file \"./${path.relative(cwd, proxyFilePath)}\" are detected. Please use \"./${path.relative(cwd, proxyFilePath)}\" only. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n            )\n          }\n          Log.warnOnce(\n            `The \"${MIDDLEWARE_FILENAME}\" file convention is deprecated. Please use \"${PROXY_FILENAME}\" instead. Learn more: https://nextjs.org/docs/messages/middleware-to-proxy`\n          )\n        }\n\n        const meta = knownFiles.get(fileName)\n\n        const watchTime = fileWatchTimes.get(fileName)\n        const nextWatchTime = meta?.timestamp\n        // If the file is showing up for the first time or the meta.timestamp is changed since last time\n        // Files that were created before we started watching are not considered changed.\n        // If any file was created by Next.js while booting, we assume those changes\n        // are handled in the bootstrap phase.\n        // Files that existed before we booted should be handled during bootstrapping.\n        const fileChanged =\n          (watchTime === undefined &&\n            (nextWatchTime === undefined ||\n              nextWatchTime >= initialWatchTime)) ||\n          (watchTime && watchTime !== nextWatchTime)\n        fileWatchTimes.set(fileName, nextWatchTime)\n\n        if (envFiles.includes(fileName)) {\n          if (fileChanged) {\n            envChange = true\n          }\n          continue\n        }\n\n        if (tsconfigPaths.includes(fileName)) {\n          if (fileName.endsWith('tsconfig.json')) {\n            enabledTypeScript = true\n          }\n          if (fileChanged) {\n            tsconfigChange = true\n          }\n          continue\n        }\n\n        if (\n          meta?.accuracy === undefined ||\n          !validFileMatcher.isPageFile(fileName)\n        ) {\n          continue\n        }\n\n        const isAppPath = Boolean(\n          appDir &&\n            normalizePathSep(fileName).startsWith(\n              normalizePathSep(appDir) + '/'\n            )\n        )\n        const isPagePath = Boolean(\n          pagesDir &&\n            normalizePathSep(fileName).startsWith(\n              normalizePathSep(pagesDir) + '/'\n            )\n        )\n\n        const rootFile = absolutePathToPage(fileName, {\n          dir: dir,\n          extensions: nextConfig.pageExtensions,\n          keepIndex: false,\n          pagesType: PAGE_TYPES.ROOT,\n        })\n\n        if (isMiddlewareFile(rootFile)) {\n          const getStaticInfoIncludingLayouts = (\n            require('../../../build/get-static-info-including-layouts') as typeof import('../../../build/get-static-info-including-layouts')\n          ).getStaticInfoIncludingLayouts\n          const staticInfo = await getStaticInfoIncludingLayouts({\n            pageFilePath: fileName,\n            config: nextConfig,\n            appDir: appDir,\n            page: rootFile,\n            isDev: true,\n            isInsideAppDir: isAppPath,\n            pageExtensions: nextConfig.pageExtensions,\n          })\n          if (nextConfig.output === 'export') {\n            Log.error(\n              'Middleware cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'\n            )\n            continue\n          }\n          serverFields.actualMiddlewareFile = rootFile\n\n          await propagateServerField(\n            opts,\n            'actualMiddlewareFile',\n            serverFields.actualMiddlewareFile\n          )\n          middlewareMatchers = staticInfo.middleware?.matchers || [\n            { regexp: '^/.*$', originalSource: '/:path*' },\n          ]\n          continue\n        }\n        if (isInstrumentationHookFile(rootFile)) {\n          serverFields.actualInstrumentationHookFile = rootFile\n          await propagateServerField(\n            opts,\n            'actualInstrumentationHookFile',\n            serverFields.actualInstrumentationHookFile\n          )\n          continue\n        }\n\n        if (fileName.endsWith('.ts') || fileName.endsWith('.tsx')) {\n          enabledTypeScript = true\n        }\n\n        if (!(isAppPath || isPagePath)) {\n          continue\n        }\n\n        // Collect all current filenames for the TS plugin to use\n        devPageFiles.add(fileName)\n\n        let pageName = absolutePathToPage(fileName, {\n          dir: isAppPath ? appDir! : pagesDir!,\n          extensions: nextConfig.pageExtensions,\n          keepIndex: isAppPath,\n          pagesType: isAppPath ? PAGE_TYPES.APP : PAGE_TYPES.PAGES,\n        })\n\n        if (\n          isAppPath &&\n          appDir &&\n          isMetadataRouteFile(\n            fileName.replace(appDir, ''),\n            nextConfig.pageExtensions,\n            true\n          )\n        ) {\n          const getPageStaticInfo = (\n            require('../../../build/analysis/get-page-static-info') as typeof import('../../../build/analysis/get-page-static-info')\n          ).getPageStaticInfo\n          const staticInfo = await getPageStaticInfo({\n            pageFilePath: fileName,\n            nextConfig: {},\n            page: pageName,\n            isDev: true,\n            pageType: PAGE_TYPES.APP,\n          })\n\n          pageName = normalizeMetadataPageToRoute(\n            pageName,\n            !!(staticInfo.generateSitemaps || staticInfo.generateImageMetadata)\n          )\n        }\n\n        if (\n          !isAppPath &&\n          pageName.startsWith('/api/') &&\n          nextConfig.output === 'export'\n        ) {\n          Log.error(\n            'API Routes cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'\n          )\n          continue\n        }\n\n        if (isAppPath) {\n          const isRootNotFound = validFileMatcher.isRootNotFound(fileName)\n          hasRootAppNotFound = true\n\n          if (isRootNotFound) {\n            continue\n          }\n\n          // Ignore files/directories starting with `_` in the app directory\n          if (normalizePathSep(pageName).includes('/_')) {\n            continue\n          }\n\n          // Record parallel route slots for layout typing\n          // May run multiple times (e.g. if a parallel route\n          // has both a layout and a page, and children) but that's fine\n          const segments = normalizePathSep(pageName).split('/')\n          for (let i = segments.length - 1; i >= 0; i--) {\n            const segment = segments[i]\n            if (isParallelRouteSegment(segment)) {\n              const parentPath = normalizeAppPath(\n                segments.slice(0, i).join('/')\n              )\n\n              const slotName = segment.slice(1)\n              // check if the slot already exists\n              if (\n                slots.some(\n                  (s) => s.name === slotName && s.parent === parentPath\n                )\n              )\n                continue\n\n              slots.push({\n                name: slotName,\n                parent: parentPath,\n              })\n              break\n            }\n          }\n\n          // Record layouts\n          if (validFileMatcher.isAppLayoutPage(fileName)) {\n            layoutRoutes.push({\n              route: ensureLeadingSlash(\n                normalizeAppPath(normalizePathSep(pageName)).replace(\n                  /\\/layout$/,\n                  ''\n                )\n              ),\n              filePath: fileName,\n            })\n          }\n\n          if (!validFileMatcher.isAppRouterPage(fileName)) {\n            continue\n          }\n\n          const originalPageName = pageName\n          pageName = normalizeAppPath(pageName).replace(/%5F/g, '_')\n          if (!appPaths[pageName]) {\n            appPaths[pageName] = []\n          }\n          appPaths[pageName].push(\n            opts.turbo\n              ? // Turbopack outputs the correct path which is normalized with the `_`.\n                originalPageName.replace(/%5F/g, '_')\n              : originalPageName\n          )\n\n          if (useFileSystemPublicRoutes) {\n            // Static metadata files will be served from filesystem.\n            if (appDir && isStaticMetadataFile(fileName.replace(appDir, ''))) {\n              // Use \"-\" placeholder for dynamic segments since static files have consistent content\n              const segment = path.posix.dirname(pageName)\n              const lastSegment = path.posix.basename(pageName)\n              const normalizedPath = fillMetadataSegment(\n                segment,\n                {},\n                lastSegment,\n                true\n              )\n              staticMetadataFiles.set(normalizedPath, fileName)\n            } else {\n              appFiles.add(pageName)\n            }\n          }\n\n          if (validFileMatcher.isAppRouterRoute(fileName)) {\n            appRouteHandlers.push({\n              route: normalizePathSep(pageName),\n              filePath: fileName,\n            })\n          } else {\n            appRoutes.push({\n              route: normalizePathSep(pageName),\n              filePath: fileName,\n            })\n          }\n\n          if (routedPages.includes(pageName)) {\n            continue\n          }\n        } else {\n          if (useFileSystemPublicRoutes) {\n            pageFiles.add(pageName)\n            // always add to nextDataRoutes for now but in future only add\n            // entries that actually use getStaticProps/getServerSideProps\n            opts.fsChecker.nextDataRoutes.add(pageName)\n          }\n\n          if (pageName.startsWith('/api/')) {\n            pageApiRoutes.push({\n              route: normalizePathSep(pageName),\n              filePath: fileName,\n            })\n          } else {\n            pageRoutes.push({\n              route: normalizePathSep(pageName),\n              filePath: fileName,\n            })\n          }\n        }\n\n        // Record pages\n        if (isAppPath) {\n          appPageFilePaths.set(pageName, fileName)\n        } else {\n          pagesPageFilePaths.set(pageName, fileName)\n        }\n\n        if (appDir && pageNameSet.has(pageName)) {\n          conflictingAppPagePaths.add(pageName)\n        } else {\n          pageNameSet.add(pageName)\n        }\n\n        /**\n         * If there is a middleware that is not declared in the root we will\n         * warn without adding it so it doesn't make its way into the system.\n         */\n        if (/[\\\\\\\\/]_middleware$/.test(pageName)) {\n          nestedMiddleware.push(pageName)\n          continue\n        }\n\n        routedPages.push(pageName)\n      }\n\n      const numConflicting = conflictingAppPagePaths.size\n      conflictingPageChange = numConflicting - previousConflictingPagePaths.size\n\n      if (conflictingPageChange !== 0) {\n        if (numConflicting > 0) {\n          let errorMessage = `Conflicting app and page file${\n            numConflicting === 1 ? ' was' : 's were'\n          } found, please remove the conflicting files to continue:\\n`\n\n          for (const p of conflictingAppPagePaths) {\n            const appPath = path.relative(dir, appPageFilePaths.get(p)!)\n            const pagesPath = path.relative(dir, pagesPageFilePaths.get(p)!)\n            errorMessage += `  \"${pagesPath}\" - \"${appPath}\"\\n`\n          }\n          hotReloader.setHmrServerError(new Error(errorMessage))\n        } else if (numConflicting === 0) {\n          hotReloader.clearHmrServerError()\n          await propagateServerField(opts, 'reloadMatchers', undefined)\n        }\n      }\n\n      previousConflictingPagePaths = conflictingAppPagePaths\n\n      let clientRouterFilters: any\n      if (nextConfig.experimental.clientRouterFilter) {\n        clientRouterFilters = createClientRouterFilter(\n          Object.keys(appPaths),\n          nextConfig.experimental.clientRouterFilterRedirects\n            ? ((nextConfig as any)._originalRedirects || []).filter(\n                (r: any) => !r.internal\n              )\n            : [],\n          nextConfig.experimental.clientRouterFilterAllowedRate\n        )\n\n        if (\n          !previousClientRouterFilters ||\n          JSON.stringify(previousClientRouterFilters) !==\n            JSON.stringify(clientRouterFilters)\n        ) {\n          envChange = true\n          previousClientRouterFilters = clientRouterFilters\n        }\n      }\n\n      if (envChange || tsconfigChange) {\n        if (envChange) {\n          writeEnvDefinitions = true\n\n          await propagateServerField(opts, 'loadEnvConfig', [\n            { dev: true, forceReload: true },\n          ])\n        }\n\n        if (hotReloader.turbopackProject) {\n          const hasRewrites =\n            opts.fsChecker.rewrites.afterFiles.length > 0 ||\n            opts.fsChecker.rewrites.beforeFiles.length > 0 ||\n            opts.fsChecker.rewrites.fallback.length > 0\n\n          const rootPath =\n            opts.nextConfig.turbopack?.root ||\n            opts.nextConfig.outputFileTracingRoot ||\n            opts.dir\n          await hotReloader.turbopackProject.update({\n            defineEnv: createDefineEnv({\n              isTurbopack: true,\n              clientRouterFilters,\n              config: nextConfig,\n              dev: true,\n              distDir,\n              fetchCacheKeyPrefix:\n                opts.nextConfig.experimental.fetchCacheKeyPrefix,\n              hasRewrites,\n              // TODO: Implement\n              middlewareMatchers: undefined,\n              projectPath: opts.dir,\n              rewrites: opts.fsChecker.rewrites,\n            }),\n            rootPath,\n            projectPath: normalizePath(path.relative(rootPath, dir)),\n          })\n        } else {\n          let tsconfigResult:\n            | UnwrapPromise<\n                ReturnType<\n                  typeof import('../../../build/load-jsconfig').default\n                >\n              >\n            | undefined\n          // This is not relevant for Turbopack because tsconfig/jsconfig is handled internally.\n          if (tsconfigChange) {\n            try {\n              const loadJsConfig = (\n                require('../../../build/load-jsconfig') as typeof import('../../../build/load-jsconfig')\n              ).default\n              tsconfigResult = await loadJsConfig(dir, nextConfig)\n            } catch (_) {\n              /* do we want to log if there are syntax errors in tsconfig while editing? */\n            }\n          }\n\n          hotReloader.activeWebpackConfigs?.forEach((config, idx) => {\n            const isClient = idx === 0\n            const isNodeServer = idx === 1\n            const isEdgeServer = idx === 2\n            const hasRewrites =\n              opts.fsChecker.rewrites.afterFiles.length > 0 ||\n              opts.fsChecker.rewrites.beforeFiles.length > 0 ||\n              opts.fsChecker.rewrites.fallback.length > 0\n\n            if (tsconfigChange) {\n              config.resolve?.plugins?.forEach((plugin: any) => {\n                // look for the JsConfigPathsPlugin and update with\n                // the latest paths/baseUrl config\n                if (plugin instanceof JsConfigPathsPlugin && tsconfigResult) {\n                  const { resolvedBaseUrl, jsConfig } = tsconfigResult\n                  const currentResolvedBaseUrl = plugin.resolvedBaseUrl\n                  const resolvedUrlIndex = config.resolve?.modules?.findIndex(\n                    (item) => item === currentResolvedBaseUrl?.baseUrl\n                  )\n\n                  if (resolvedBaseUrl) {\n                    if (\n                      resolvedBaseUrl.baseUrl !==\n                      currentResolvedBaseUrl?.baseUrl\n                    ) {\n                      // remove old baseUrl and add new one\n                      if (resolvedUrlIndex && resolvedUrlIndex > -1) {\n                        config.resolve?.modules?.splice(resolvedUrlIndex, 1)\n                      }\n\n                      // If the resolvedBaseUrl is implicit we only remove the previous value.\n                      // Only add the baseUrl if it's explicitly set in tsconfig/jsconfig\n                      if (!resolvedBaseUrl.isImplicit) {\n                        config.resolve?.modules?.push(resolvedBaseUrl.baseUrl)\n                      }\n                    }\n                  }\n\n                  if (jsConfig?.compilerOptions?.paths && resolvedBaseUrl) {\n                    Object.keys(plugin.paths).forEach((key) => {\n                      delete plugin.paths[key]\n                    })\n                    Object.assign(plugin.paths, jsConfig.compilerOptions.paths)\n                    plugin.resolvedBaseUrl = resolvedBaseUrl\n                  }\n                }\n              })\n            }\n\n            if (envChange) {\n              config.plugins?.forEach((plugin: any) => {\n                // we look for the DefinePlugin definitions so we can\n                // update them on the active compilers\n                if (\n                  plugin &&\n                  typeof plugin.definitions === 'object' &&\n                  plugin.definitions.__NEXT_DEFINE_ENV\n                ) {\n                  const newDefine = getDefineEnv({\n                    isTurbopack: false,\n                    clientRouterFilters,\n                    config: nextConfig,\n                    dev: true,\n                    distDir,\n                    fetchCacheKeyPrefix:\n                      opts.nextConfig.experimental.fetchCacheKeyPrefix,\n                    hasRewrites,\n                    isClient,\n                    isEdgeServer,\n                    isNodeServer,\n                    middlewareMatchers: undefined,\n                    projectPath: opts.dir,\n                    rewrites: opts.fsChecker.rewrites,\n                  })\n\n                  Object.keys(plugin.definitions).forEach((key) => {\n                    if (!(key in newDefine)) {\n                      delete plugin.definitions[key]\n                    }\n                  })\n                  Object.assign(plugin.definitions, newDefine)\n                }\n              })\n            }\n          })\n        }\n        await hotReloader.invalidate({\n          reloadAfterInvalidation: envChange,\n        })\n      }\n\n      if (nestedMiddleware.length > 0) {\n        Log.error(\n          new NestedMiddlewareError(\n            nestedMiddleware,\n            dir,\n            (pagesDir || appDir)!\n          ).message\n        )\n        nestedMiddleware = []\n      }\n\n      // Make sure to sort parallel routes to make the result deterministic.\n      serverFields.appPathRoutes = Object.fromEntries(\n        Object.entries(appPaths).map(([k, v]) => [k, v.sort()])\n      )\n      await propagateServerField(\n        opts,\n        'appPathRoutes',\n        serverFields.appPathRoutes\n      )\n\n      // TODO: pass this to fsChecker/next-dev-server?\n      serverFields.middleware = middlewareMatchers\n        ? {\n            match: null as any,\n            page: '/',\n            matchers: middlewareMatchers,\n          }\n        : undefined\n\n      await propagateServerField(opts, 'middleware', serverFields.middleware)\n      serverFields.hasAppNotFound = hasRootAppNotFound\n\n      opts.fsChecker.middlewareMatcher = serverFields.middleware?.matchers\n        ? getMiddlewareRouteMatcher(serverFields.middleware?.matchers)\n        : undefined\n\n      const interceptionRoutes = generateInterceptionRoutesRewrites(\n        Object.keys(appPaths),\n        opts.nextConfig.basePath\n      ).map((item) =>\n        buildCustomRoute(\n          'before_files_rewrite',\n          item,\n          opts.nextConfig.basePath,\n          opts.nextConfig.experimental.caseSensitiveRoutes\n        )\n      )\n\n      opts.fsChecker.rewrites.beforeFiles.push(...interceptionRoutes)\n\n      const exportPathMap =\n        (typeof nextConfig.exportPathMap === 'function' &&\n          (await nextConfig.exportPathMap?.(\n            {},\n            {\n              dev: true,\n              dir: opts.dir,\n              outDir: null,\n              distDir: distDir,\n              buildId: 'development',\n            }\n          ))) ||\n        {}\n\n      const exportPathMapEntries = Object.entries(exportPathMap || {})\n\n      if (exportPathMapEntries.length > 0) {\n        opts.fsChecker.exportPathMapRoutes = exportPathMapEntries.map(\n          ([key, value]) =>\n            buildCustomRoute(\n              'before_files_rewrite',\n              {\n                source: key,\n                destination: `${value.page}${\n                  value.query ? '?' : ''\n                }${qs.stringify(value.query)}`,\n              },\n              opts.nextConfig.basePath,\n              opts.nextConfig.experimental.caseSensitiveRoutes\n            )\n        )\n      }\n\n      try {\n        // we serve a separate manifest with all pages for the client in\n        // dev mode so that we can match a page after a rewrite on the client\n        // before it has been built and is populated in the _buildManifest\n        const sortedRoutes = getSortedRoutes(routedPages)\n\n        opts.fsChecker.dynamicRoutes = sortedRoutes.map(\n          (page): FilesystemDynamicRoute => {\n            const regex = getNamedRouteRegex(page, {\n              prefixRouteKeys: true,\n            })\n            return {\n              regex: regex.re.toString(),\n              namedRegex: regex.namedRegex,\n              routeKeys: regex.routeKeys,\n              match: getRouteMatcher(regex),\n              page,\n            }\n          }\n        )\n\n        const dataRoutes: typeof opts.fsChecker.dynamicRoutes = []\n\n        for (const page of sortedRoutes) {\n          const route = buildDataRoute(page, 'development')\n          const routeRegex = getNamedRouteRegex(route.page, {\n            prefixRouteKeys: true,\n          })\n          dataRoutes.push({\n            ...route,\n            regex: routeRegex.re.toString(),\n            namedRegex: routeRegex.namedRegex,\n            routeKeys: routeRegex.routeKeys,\n            match: getRouteMatcher({\n              // TODO: fix this in the manifest itself, must also be fixed in\n              // upstream builder that relies on this\n              re: opts.nextConfig.i18n\n                ? new RegExp(\n                    route.dataRouteRegex.replace(\n                      `/development/`,\n                      `/development/(?<nextLocale>[^/]+?)/`\n                    )\n                  )\n                : new RegExp(route.dataRouteRegex),\n              groups: routeRegex.groups,\n            }),\n          })\n        }\n        opts.fsChecker.dynamicRoutes.unshift(...dataRoutes)\n\n        // For Turbopack ADDED_PAGE and REMOVED_PAGE are implemented in hot-reloader-turbopack.ts\n        // in order to avoid a race condition where ADDED_PAGE and REMOVED_PAGE are sent before Turbopack picked up the file change.\n        if (!opts.turbo) {\n          // Reload the matchers. The filesystem would have been written to,\n          // and the matchers need to re-scan it to update the router.\n          // Reloading the matchers should happen before `ADDED_PAGE` or `REMOVED_PAGE` is sent over the websocket\n          // otherwise it sends the event too early.\n          await propagateServerField(opts, 'reloadMatchers', undefined)\n\n          if (\n            !prevSortedRoutes?.every((val, idx) => val === sortedRoutes[idx])\n          ) {\n            const addedRoutes = sortedRoutes.filter(\n              (route) => !prevSortedRoutes.includes(route)\n            )\n            const removedRoutes = prevSortedRoutes.filter(\n              (route) => !sortedRoutes.includes(route)\n            )\n\n            // emit the change so clients fetch the update\n            hotReloader.send({\n              type: HMR_MESSAGE_SENT_TO_BROWSER.DEV_PAGES_MANIFEST_UPDATE,\n              data: [\n                {\n                  devPagesManifest: true,\n                },\n              ],\n            })\n\n            addedRoutes.forEach((route) => {\n              hotReloader.send({\n                type: HMR_MESSAGE_SENT_TO_BROWSER.ADDED_PAGE,\n                data: [route],\n              })\n            })\n\n            removedRoutes.forEach((route) => {\n              hotReloader.send({\n                type: HMR_MESSAGE_SENT_TO_BROWSER.REMOVED_PAGE,\n                data: [route],\n              })\n            })\n          }\n        }\n        prevSortedRoutes = sortedRoutes\n\n        if (enabledTypeScript) {\n          // Using === false to make the check clearer.\n          if (typescriptStatusFromLastAggregation === false) {\n            // we tolerate the error here as this is best effort\n            // and the manual install command will be shown\n            await verifyTypeScript(opts)\n              .then(() => {\n                tsconfigChange = true\n              })\n              .catch(() => {})\n          }\n\n          if (writeEnvDefinitions && nextConfig.experimental?.typedEnv) {\n            // TODO: The call to propagateServerField 'loadEnvConfig' causes the env to be loaded twice on env file changes.\n            const loadEnvConfig = (\n              require('@next/env') as typeof import('@next/env')\n            ).loadEnvConfig\n            const { loadedEnvFiles } = loadEnvConfig(\n              dir,\n              process.env.NODE_ENV === 'development',\n              // Silent as it's the second time `loadEnvConfig` is called in this pass.\n              undefined,\n              true\n            )\n\n            const createEnvDefinitions = (\n              require('../experimental/create-env-definitions') as typeof import('../experimental/create-env-definitions')\n            ).createEnvDefinitions\n            await createEnvDefinitions({\n              distDir,\n              loadedEnvFiles: [\n                ...loadedEnvFiles,\n                {\n                  path: nextConfig.configFileName,\n                  env: nextConfig.env,\n                  contents: '',\n                },\n              ],\n            })\n          }\n\n          const routeTypesManifest = await createRouteTypesManifest({\n            dir,\n            pageRoutes,\n            appRoutes,\n            layoutRoutes,\n            slots,\n            redirects: opts.nextConfig.redirects,\n            rewrites: opts.nextConfig.rewrites,\n            // Ensure relative paths in validator.ts are computed from validatorFilePath,\n            // matching behavior of build and CLI typegen.\n            validatorFilePath,\n            appRouteHandlers,\n            pageApiRoutes,\n          })\n\n          await writeRouteTypesManifest(\n            routeTypesManifest,\n            routeTypesFilePath,\n            opts.nextConfig\n          )\n          await writeValidatorFile(\n            routeTypesManifest,\n            validatorFilePath,\n            Boolean(nextConfig.experimental.strictRouteTypes)\n          )\n\n          // Generate cache-life types if cacheLife config exists\n          const cacheLifeFilePath = path.join(distTypesDir, 'cache-life.d.ts')\n          writeCacheLifeTypes(opts.nextConfig.cacheLife, cacheLifeFilePath)\n\n          // Write the entry file at {distDirRoot}/types/routes.d.ts\n          // This ensures next-env.d.ts has a consistent import path\n          const entryFilePath = path.join(\n            opts.dir,\n            opts.nextConfig.distDirRoot,\n            'types',\n            'routes.d.ts'\n          )\n          await writeRouteTypesEntryFile(entryFilePath, distTypesDir, {\n            strictRouteTypes: Boolean(nextConfig.experimental.strictRouteTypes),\n            typedRoutes: Boolean(nextConfig.typedRoutes),\n          })\n        }\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      } catch (e) {\n        if (!resolved) {\n          reject(e)\n          resolved = true\n        } else {\n          Log.warn('Failed to reload dynamic routes:', e)\n        }\n      }\n    })\n\n    wp.watch({ directories: [dir], startTime: 0 })\n  })\n\n  const clientPagesManifestPath = `/_next/${CLIENT_STATIC_FILES_PATH}/development/${DEV_CLIENT_PAGES_MANIFEST}`\n  opts.fsChecker.devVirtualFsItems.add(clientPagesManifestPath)\n\n  const devMiddlewareManifestPath = `/_next/${CLIENT_STATIC_FILES_PATH}/development/${DEV_CLIENT_MIDDLEWARE_MANIFEST}`\n  opts.fsChecker.devVirtualFsItems.add(devMiddlewareManifestPath)\n\n  const devTurbopackMiddlewareManifestPath = `/_next/${CLIENT_STATIC_FILES_PATH}/development/${TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST}`\n  opts.fsChecker.devVirtualFsItems.add(devTurbopackMiddlewareManifestPath)\n\n  async function requestHandler(req: IncomingMessage, res: ServerResponse) {\n    const parsedUrl = parseUrl(req.url || '/')\n    const pathname = parsedUrl !== undefined ? parsedUrl.pathname : null\n\n    if (pathname !== null && pathname.includes(clientPagesManifestPath)) {\n      res.statusCode = 200\n      res.setHeader('Content-Type', JSON_CONTENT_TYPE_HEADER)\n      res.end(\n        JSON.stringify({\n          pages: prevSortedRoutes.filter(\n            (route) => !opts.fsChecker.appFiles.has(route)\n          ),\n        })\n      )\n      return { finished: true }\n    }\n\n    if (\n      pathname !== null &&\n      (pathname.includes(devMiddlewareManifestPath) ||\n        pathname.includes(devTurbopackMiddlewareManifestPath))\n    ) {\n      res.statusCode = 200\n      res.setHeader('Content-Type', JSON_CONTENT_TYPE_HEADER)\n      res.end(JSON.stringify(serverFields.middleware?.matchers || []))\n      return { finished: true }\n    }\n    return { finished: false }\n  }\n\n  function logErrorWithOriginalStack(\n    err: unknown,\n    type?: 'unhandledRejection' | 'uncaughtException' | 'warning' | 'app-dir'\n  ) {\n    if (err instanceof Error) {\n      err.message = deobfuscateText(err.message)\n    }\n    if (err instanceof ModuleBuildError) {\n      // Errors that may come from issues from the user's code\n      Log.error(err.message)\n    } else if (err instanceof TurbopackInternalError) {\n      // An internal Turbopack error that has been handled by next-swc, written\n      // to disk and a simplified message shown to user on the Rust side.\n    } else if (type === 'warning') {\n      Log.warn(err)\n    } else if (type === 'app-dir') {\n      Log.error(err)\n    } else if (type) {\n      Log.error(`${type}:`, err)\n    } else {\n      Log.error(err)\n    }\n  }\n\n  return {\n    serverFields,\n    hotReloader,\n    requestHandler,\n    logErrorWithOriginalStack,\n\n    async ensureMiddleware(requestUrl?: string) {\n      if (!serverFields.actualMiddlewareFile) return\n      return hotReloader.ensurePage({\n        page: serverFields.actualMiddlewareFile,\n        clientOnly: false,\n        definition: undefined,\n        url: requestUrl,\n      })\n    },\n  }\n}\n\nexport async function setupDevBundler(opts: SetupOpts) {\n  const isSrcDir = path\n    .relative(opts.dir, opts.pagesDir || opts.appDir || '')\n    .startsWith('src')\n  await installBindings(opts.nextConfig.experimental?.useWasmBinary)\n  const result = await startWatcher({\n    ...opts,\n    isSrcDir,\n  })\n\n  opts.telemetry.record(\n    eventCliSession(opts.nextConfig, {\n      webpackVersion: 5,\n      isSrcDir,\n      turboFlag: !!opts.turbo,\n      cliCommand: 'dev',\n      appDir: !!opts.appDir,\n      pagesDir: !!opts.pagesDir,\n      isCustomServer: !!opts.isCustomServer,\n      hasNowJson: !!(await findUp('now.json', { cwd: opts.dir })),\n    })\n  )\n\n  // Track build features for dev server here:\n  opts.telemetry.record({\n    eventName: EVENT_BUILD_FEATURE_USAGE,\n    payload: {\n      featureName: 'turbopackFileSystemCache',\n      invocationCount: isFileSystemCacheEnabledForDev(opts.nextConfig) ? 1 : 0,\n    },\n  })\n\n  return result\n}\n\nexport type DevBundler = Awaited<ReturnType<typeof setupDevBundler>>\n\n// Returns a trace rewritten through Turbopack's sourcemaps\n"],"names":["createDefineEnv","installBindings","fs","path","qs","Watchpack","findUp","buildCustomRoute","Log","setGlobal","createValidFileMatcher","EVENT_BUILD_FEATURE_USAGE","eventCliSession","getSortedRoutes","sortByPageExts","verifyTypeScriptSetup","verifyPartytownSetup","getNamedRouteRegex","normalizeAppPath","buildDataRoute","getRouteMatcher","normalizePathSep","createClientRouterFilter","absolutePathToPage","generateInterceptionRoutesRewrites","CLIENT_STATIC_FILES_PATH","DEV_CLIENT_PAGES_MANIFEST","DEV_CLIENT_MIDDLEWARE_MANIFEST","PHASE_DEVELOPMENT_SERVER","TURBOPACK_CLIENT_MIDDLEWARE_MANIFEST","ROUTES_MANIFEST","PRERENDER_MANIFEST","getMiddlewareRouteMatcher","isMiddlewareFile","NestedMiddlewareError","isInstrumentationHookFile","getPossibleMiddlewareFilenames","getPossibleInstrumentationHookFilenames","devPageFiles","HMR_MESSAGE_SENT_TO_BROWSER","PAGE_TYPES","generateEncryptionKeyBase64","isMetadataRouteFile","isStaticMetadataFile","fillMetadataSegment","normalizeMetadataPageToRoute","JsConfigPathsPlugin","store","consoleStore","isFileSystemCacheEnabledForDev","ModuleBuildError","getDefineEnv","TurbopackInternalError","normalizePath","JSON_CONTENT_TYPE_HEADER","MIDDLEWARE_FILENAME","PROXY_FILENAME","parseUrl","createRouteTypesManifest","writeRouteTypesManifest","writeValidatorFile","writeRouteTypesEntryFile","writeCacheLifeTypes","isParallelRouteSegment","ensureLeadingSlash","Lockfile","deobfuscateText","verifyTypeScript","opts","verifyResult","dir","distDir","nextConfig","distDirRoot","strictRouteTypes","Boolean","experimental","typeCheckPreflight","tsconfigPath","typescript","disableStaticImages","images","hasAppDir","appDir","hasPagesDir","pagesDir","version","propagateServerField","field","args","renderServer","instance","startWatcher","resetFetch","useFileSystemPublicRoutes","join","lockfile","lockDistDir","mkdirSync","recursive","appUrl","port","serverInfo","pid","process","hostname","startedAt","Date","now","acquireWithRetriesOrExit","JSON","stringify","validFileMatcher","pageExtensions","serverFields","setState","logging","hotReloader","turbo","createHotReloaderTurbopack","require","HotReloader","env","NEXT_RSPACK","default","isSrcDir","config","buildId","encryptionKey","isBuild","telemetry","rewrites","fsChecker","previewProps","prerenderManifest","preview","onDevServerCleanup","start","distTypesDir","appRoutes","pageRoutes","layoutRoutes","appRouteHandlerRoutes","redirectRoutes","rewriteRoutes","appPagePaths","Set","pagesRouterPagePaths","layoutPaths","appRouteHandlers","pageApiRoutes","filePathToRoute","Map","initialEntryFilePath","typedRoutes","routesManifestPath","routesManifest","caseSensitive","caseSensitiveRoutes","basePath","redirects","headers","i18n","undefined","skipProxyUrlNormalize","promises","writeFile","prerenderManifestPath","nextScriptWorkers","ensureCallback","ensure","item","type","ensurePage","clientOnly","page","itemPath","isApp","definition","resolved","prevSortedRoutes","Promise","resolve","reject","readdir","_","files","length","pages","app","directories","rootDir","nestedMiddleware","envFiles","map","file","push","tsconfigPaths","wp","aggregateTimeout","ignored","pathname","some","startsWith","d","fileWatchTimes","enabledTypeScript","previousClientRouterFilters","previousConflictingPagePaths","routeTypesFilePath","validatorFilePath","initialWatchTime","performance","timeOrigin","on","writeEnvDefinitions","typescriptStatusFromLastAggregation","middlewareMatchers","routedPages","knownFiles","getTimeInfoEntries","appPaths","pageNameSet","conflictingAppPagePaths","appPageFilePaths","pagesPageFilePaths","slots","envChange","tsconfigChange","conflictingPageChange","hasRootAppNotFound","appFiles","pageFiles","staticMetadataFiles","clear","sortedKnownFiles","keys","sort","proxyFilePath","middlewareFilePath","fileName","includes","name","fileBaseName","fileDir","parse","isAtConventionLevel","cwd","Error","relative","warnOnce","meta","get","watchTime","nextWatchTime","timestamp","fileChanged","set","endsWith","accuracy","isPageFile","isAppPath","isPagePath","rootFile","extensions","keepIndex","pagesType","ROOT","staticInfo","getStaticInfoIncludingLayouts","pageFilePath","isDev","isInsideAppDir","output","error","actualMiddlewareFile","middleware","matchers","regexp","originalSource","actualInstrumentationHookFile","add","pageName","APP","PAGES","replace","getPageStaticInfo","pageType","generateSitemaps","generateImageMetadata","isRootNotFound","segments","split","i","segment","parentPath","slice","slotName","s","parent","isAppLayoutPage","route","filePath","isAppRouterPage","originalPageName","posix","dirname","lastSegment","basename","normalizedPath","isAppRouterRoute","nextDataRoutes","has","test","numConflicting","size","errorMessage","p","appPath","pagesPath","setHmrServerError","clearHmrServerError","clientRouterFilters","clientRouterFilter","Object","clientRouterFilterRedirects","_originalRedirects","filter","r","internal","clientRouterFilterAllowedRate","dev","forceReload","turbopackProject","hasRewrites","afterFiles","beforeFiles","fallback","rootPath","turbopack","root","outputFileTracingRoot","update","defineEnv","isTurbopack","fetchCacheKeyPrefix","projectPath","tsconfigResult","loadJsConfig","activeWebpackConfigs","forEach","idx","isClient","isNodeServer","isEdgeServer","plugins","plugin","jsConfig","resolvedBaseUrl","currentResolvedBaseUrl","resolvedUrlIndex","modules","findIndex","baseUrl","splice","isImplicit","compilerOptions","paths","key","assign","definitions","__NEXT_DEFINE_ENV","newDefine","invalidate","reloadAfterInvalidation","message","appPathRoutes","fromEntries","entries","k","v","match","hasAppNotFound","middlewareMatcher","interceptionRoutes","exportPathMap","outDir","exportPathMapEntries","exportPathMapRoutes","value","source","destination","query","sortedRoutes","dynamicRoutes","regex","prefixRouteKeys","re","toString","namedRegex","routeKeys","dataRoutes","routeRegex","RegExp","dataRouteRegex","groups","unshift","every","val","addedRoutes","removedRoutes","send","DEV_PAGES_MANIFEST_UPDATE","data","devPagesManifest","ADDED_PAGE","REMOVED_PAGE","then","catch","typedEnv","loadEnvConfig","loadedEnvFiles","NODE_ENV","createEnvDefinitions","configFileName","contents","routeTypesManifest","cacheLifeFilePath","cacheLife","entryFilePath","e","warn","watch","startTime","clientPagesManifestPath","devVirtualFsItems","devMiddlewareManifestPath","devTurbopackMiddlewareManifestPath","requestHandler","req","res","parsedUrl","url","statusCode","setHeader","end","finished","logErrorWithOriginalStack","err","ensureMiddleware","requestUrl","setupDevBundler","useWasmBinary","result","record","webpackVersion","turboFlag","cliCommand","isCustomServer","hasNowJson","eventName","payload","featureName","invocationCount"],"mappings":"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","ignoreList":[0]}