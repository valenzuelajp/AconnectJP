{"version":3,"sources":["../../../../src/build/templates/edge-ssr-app.ts"],"sourcesContent":["import '../../server/web/globals'\nimport {\n  adapter,\n  type EdgeHandler,\n  type NextRequestHint,\n} from '../../server/web/adapter'\nimport { IncrementalCache } from '../../server/lib/incremental-cache'\n\nimport * as pageMod from 'VAR_USERLAND'\n\nimport { setManifestsSingleton } from '../../server/app-render/manifests-singleton'\nimport { initializeCacheHandlers } from '../../server/use-cache/handlers'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport { getTracer, SpanKind, type Span } from '../../server/lib/trace/tracer'\nimport { WebNextRequest, WebNextResponse } from '../../server/base-http/web'\nimport type { NextFetchEvent } from '../../server/web/spec-extension/fetch-event'\nimport type {\n  AppPageRouteHandlerContext,\n  AppPageRouteModule,\n} from '../../server/route-modules/app-page/module.compiled'\nimport type { AppPageRenderResultMetadata } from '../../server/render-result'\nimport type RenderResult from '../../server/render-result'\nimport { getIsPossibleServerAction } from '../../server/lib/server-action-request-meta'\nimport { getBotType } from '../../shared/lib/router/utils/is-bot'\nimport { interopDefault } from '../../lib/interop-default'\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\nimport { checkIsOnDemandRevalidate } from '../../server/api-utils'\nimport { CloseController } from '../../server/web/web-on-close'\nimport { parseMaxPostponedStateSize } from '../../shared/lib/size-limit'\nimport { toNodeOutgoingHttpHeaders } from '../../server/web/utils'\nimport type { RequestMeta } from '../../server/request-meta'\n\ndeclare const incrementalCacheHandler: any\n// OPTIONAL_IMPORT:incrementalCacheHandler\n\nconst maybeJSONParse = (str?: string) => (str ? JSON.parse(str) : undefined)\n\nconst rscManifest = self.__RSC_MANIFEST?.['VAR_PAGE']\nconst rscServerManifest = maybeJSONParse(self.__RSC_SERVER_MANIFEST)\n\nif (rscManifest && rscServerManifest) {\n  setManifestsSingleton({\n    page: 'VAR_PAGE',\n    clientReferenceManifest: rscManifest,\n    serverActionsManifest: rscServerManifest,\n  })\n}\n\nexport const ComponentMod = pageMod\n\nasync function requestHandler(\n  req: NextRequestHint,\n  event: NextFetchEvent\n): Promise<Response> {\n  let srcPage = 'VAR_PAGE'\n\n  const normalizedSrcPage = normalizeAppPath(srcPage)\n  const relativeUrl = `${req.nextUrl.pathname}${req.nextUrl.search}`\n  const baseReq = new WebNextRequest(req)\n  const baseRes = new WebNextResponse(undefined)\n\n  const pageRouteModule = pageMod.routeModule as AppPageRouteModule\n  const prepareResult = await pageRouteModule.prepare(baseReq, null, {\n    srcPage,\n    multiZoneDraftMode: false,\n  })\n\n  if (!prepareResult) {\n    return new Response('Bad Request', {\n      status: 400,\n    })\n  }\n  const {\n    query,\n    params,\n    buildId,\n    nextConfig,\n    buildManifest,\n    prerenderManifest,\n    reactLoadableManifest,\n    subresourceIntegrityManifest,\n    dynamicCssManifest,\n    nextFontManifest,\n    resolvedPathname,\n    interceptionRoutePatterns,\n    routerServerContext,\n    deploymentId,\n  } = prepareResult\n\n  // Initialize the cache handlers interface.\n  initializeCacheHandlers(nextConfig.cacheMaxMemorySize)\n\n  const isPossibleServerAction = getIsPossibleServerAction(req)\n  const botType = getBotType(req.headers.get('User-Agent') || '')\n  const { isOnDemandRevalidate } = checkIsOnDemandRevalidate(\n    req,\n    prerenderManifest.preview\n  )\n\n  const closeController = new CloseController()\n\n  const renderContext: AppPageRouteHandlerContext = {\n    page: normalizedSrcPage,\n    query,\n    params,\n\n    sharedContext: {\n      buildId,\n      deploymentId,\n    },\n    fallbackRouteParams: null,\n\n    renderOpts: {\n      App: () => null,\n      Document: () => null,\n      pageConfig: {},\n      ComponentMod,\n      Component: interopDefault(ComponentMod),\n      routeModule: pageRouteModule,\n\n      params,\n      page: srcPage,\n      postponed: undefined,\n      shouldWaitOnAllReady: false,\n      serveStreamingMetadata: true,\n      supportsDynamicResponse: true,\n      buildManifest,\n      nextFontManifest,\n      reactLoadableManifest,\n      subresourceIntegrityManifest,\n      dynamicCssManifest,\n      setIsrStatus: routerServerContext?.setIsrStatus,\n\n      dir: pageRouteModule.relativeProjectDir,\n      botType,\n      isDraftMode: false,\n      isOnDemandRevalidate,\n      isPossibleServerAction,\n      assetPrefix: nextConfig.assetPrefix,\n      nextConfigOutput: nextConfig.output,\n      crossOrigin: nextConfig.crossOrigin,\n      trailingSlash: nextConfig.trailingSlash,\n      images: nextConfig.images,\n      previewProps: prerenderManifest.preview,\n      enableTainting: nextConfig.experimental.taint,\n      htmlLimitedBots: nextConfig.htmlLimitedBots,\n      reactMaxHeadersLength: nextConfig.reactMaxHeadersLength,\n\n      multiZoneDraftMode: false,\n      cacheLifeProfiles: nextConfig.cacheLife,\n      basePath: nextConfig.basePath,\n      serverActions: nextConfig.experimental.serverActions,\n      cacheComponents: Boolean(nextConfig.cacheComponents),\n      experimental: {\n        isRoutePPREnabled: false,\n        expireTime: nextConfig.expireTime,\n        staleTimes: nextConfig.experimental.staleTimes,\n        dynamicOnHover: Boolean(nextConfig.experimental.dynamicOnHover),\n        optimisticRouting: Boolean(nextConfig.experimental.optimisticRouting),\n        inlineCss: Boolean(nextConfig.experimental.inlineCss),\n        authInterrupts: Boolean(nextConfig.experimental.authInterrupts),\n        clientTraceMetadata:\n          nextConfig.experimental.clientTraceMetadata || ([] as any),\n        clientParamParsingOrigins:\n          nextConfig.experimental.clientParamParsingOrigins,\n        maxPostponedStateSizeBytes: parseMaxPostponedStateSize(\n          nextConfig.experimental.maxPostponedStateSize\n        ),\n      },\n\n      incrementalCache: await pageRouteModule.getIncrementalCache(\n        baseReq,\n        nextConfig,\n        prerenderManifest,\n        true\n      ),\n\n      waitUntil: event.waitUntil.bind(event),\n      onClose: (cb) => {\n        closeController.onClose(cb)\n      },\n      onAfterTaskError: () => {},\n\n      onInstrumentationRequestError: (\n        error,\n        _request,\n        errorContext,\n        silenceLog\n      ) =>\n        pageRouteModule.onRequestError(\n          baseReq,\n          error,\n          errorContext,\n          silenceLog,\n          routerServerContext\n        ),\n      dev: pageRouteModule.isDev,\n    },\n  }\n  let finalStatus = 200\n\n  const renderResultToResponse = (\n    result: RenderResult<AppPageRenderResultMetadata>\n  ): Response => {\n    const varyHeader = pageRouteModule.getVaryHeader(\n      resolvedPathname,\n      interceptionRoutePatterns\n    )\n    // Handle null responses\n    if (result.isNull) {\n      finalStatus = 500\n      closeController.dispatchClose()\n      return new Response(null, { status: 500 })\n    }\n\n    // Extract metadata\n    const { metadata } = result\n    const headers = new Headers()\n    finalStatus = metadata.statusCode || baseRes.statusCode || 200\n    // Pull any fetch metrics from the render onto the request.\n    ;(req as any).fetchMetrics = metadata.fetchMetrics\n\n    // Set content type\n    const contentType = result.contentType || 'text/html; charset=utf-8'\n    headers.set('Content-Type', contentType)\n    headers.set('x-edge-runtime', '1')\n\n    if (varyHeader) {\n      headers.set('Vary', varyHeader)\n    }\n\n    // Add existing headers\n    for (const [key, value] of Object.entries({\n      ...baseRes.getHeaders(),\n      ...metadata.headers,\n    })) {\n      if (value !== undefined) {\n        if (Array.isArray(value)) {\n          // Handle multiple header values\n          for (const v of value) {\n            headers.append(key, String(v))\n          }\n        } else {\n          headers.set(key, String(value))\n        }\n      }\n    }\n\n    // Handle static response\n    if (!result.isDynamic) {\n      const body = result.toUnchunkedString()\n      headers.set(\n        'Content-Length',\n        String(new TextEncoder().encode(body).length)\n      )\n      closeController.dispatchClose()\n      return new Response(body, {\n        status: finalStatus,\n        headers,\n      })\n    }\n\n    // Handle dynamic/streaming response\n    // For edge runtime, we need to create a readable stream that pipes from the result\n    const { readable, writable } = new TransformStream()\n\n    // Start piping the result to the writable stream\n    // This is done asynchronously to avoid blocking the response creation\n    result\n      .pipeTo(writable)\n      .catch((err: unknown) => {\n        console.error('Error piping RenderResult to response:', err)\n      })\n      .finally(() => closeController.dispatchClose())\n\n    return new Response(readable, {\n      status: finalStatus,\n      headers,\n    })\n  }\n\n  const invokeRender = async (span?: Span): Promise<Response> => {\n    try {\n      const result = await pageRouteModule\n        .render(baseReq, baseRes, renderContext)\n        .finally(() => {\n          if (!span) return\n\n          span.setAttributes({\n            'http.status_code': finalStatus,\n            'next.rsc': false,\n          })\n\n          const rootSpanAttributes = tracer.getRootSpanAttributes()\n          // We were unable to get attributes, probably OTEL is not enabled\n          if (!rootSpanAttributes) {\n            return\n          }\n\n          if (\n            rootSpanAttributes.get('next.span_type') !==\n            BaseServerSpan.handleRequest\n          ) {\n            console.warn(\n              `Unexpected root span type '${rootSpanAttributes.get(\n                'next.span_type'\n              )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n            )\n            return\n          }\n\n          const route = normalizedSrcPage\n          if (route) {\n            const name = `${req.method} ${route}`\n\n            span.setAttributes({\n              'next.route': route,\n              'http.route': route,\n              'next.span_name': name,\n            })\n            span.updateName(name)\n          } else {\n            span.updateName(`${req.method} ${srcPage}`)\n          }\n        })\n\n      return renderResultToResponse(result)\n    } catch (err) {\n      const silenceLog = false\n      await pageRouteModule.onRequestError(\n        baseReq,\n        err,\n        {\n          routerKind: 'App Router',\n          routePath: normalizedSrcPage,\n          routeType: 'render',\n          revalidateReason: undefined,\n        },\n        silenceLog\n      )\n      // rethrow so that we can handle serving error page\n      throw err\n    }\n  }\n\n  const tracer = getTracer()\n\n  return tracer.withPropagatedContext(req.headers, () =>\n    tracer.trace(\n      BaseServerSpan.handleRequest,\n      {\n        spanName: `${req.method} ${srcPage}`,\n        kind: SpanKind.SERVER,\n        attributes: {\n          'http.method': req.method,\n          'http.target': relativeUrl,\n          'http.route': normalizedSrcPage,\n        },\n      },\n      invokeRender\n    )\n  )\n}\n\nconst internalHandler: EdgeHandler = (opts) => {\n  return adapter({\n    ...opts,\n    IncrementalCache,\n    handler: requestHandler,\n    incrementalCacheHandler,\n    page: 'VAR_PAGE',\n  })\n}\n\nexport async function handler(\n  request: Request,\n  ctx: {\n    waitUntil?: (prom: Promise<void>) => void\n    signal?: AbortSignal\n    requestMeta?: RequestMeta\n  }\n): Promise<Response> {\n  const result = await internalHandler({\n    request: {\n      url: request.url,\n      method: request.method,\n      headers: toNodeOutgoingHttpHeaders(request.headers),\n      nextConfig: {\n        basePath: process.env.__NEXT_BASE_PATH,\n        i18n: process.env.__NEXT_I18N_CONFIG as any,\n        trailingSlash: Boolean(process.env.__NEXT_TRAILING_SLASH),\n        experimental: {\n          cacheLife: process.env.__NEXT_CACHE_LIFE as any,\n          authInterrupts: Boolean(\n            process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS\n          ),\n          clientParamParsingOrigins: process.env\n            .__NEXT_CLIENT_PARAM_PARSING_ORIGINS as any,\n        },\n      },\n      page: {\n        name: 'VAR_PAGE',\n      },\n      body:\n        request.method !== 'GET' && request.method !== 'HEAD'\n          ? (request.body ?? undefined)\n          : undefined,\n      waitUntil: ctx.waitUntil,\n      requestMeta: ctx.requestMeta,\n      signal: ctx.signal || new AbortController().signal,\n    },\n  })\n\n  ctx.waitUntil?.(result.waitUntil)\n\n  return result.response\n}\n\n// backwards compat\nexport default internalHandler\n"],"names":["self","adapter","IncrementalCache","pageMod","setManifestsSingleton","initializeCacheHandlers","BaseServerSpan","getTracer","SpanKind","WebNextRequest","WebNextResponse","getIsPossibleServerAction","getBotType","interopDefault","normalizeAppPath","checkIsOnDemandRevalidate","CloseController","parseMaxPostponedStateSize","toNodeOutgoingHttpHeaders","maybeJSONParse","str","JSON","parse","undefined","rscManifest","__RSC_MANIFEST","rscServerManifest","__RSC_SERVER_MANIFEST","page","clientReferenceManifest","serverActionsManifest","ComponentMod","requestHandler","req","event","srcPage","normalizedSrcPage","relativeUrl","nextUrl","pathname","search","baseReq","baseRes","pageRouteModule","routeModule","prepareResult","prepare","multiZoneDraftMode","Response","status","query","params","buildId","nextConfig","buildManifest","prerenderManifest","reactLoadableManifest","subresourceIntegrityManifest","dynamicCssManifest","nextFontManifest","resolvedPathname","interceptionRoutePatterns","routerServerContext","deploymentId","cacheMaxMemorySize","isPossibleServerAction","botType","headers","get","isOnDemandRevalidate","preview","closeController","renderContext","sharedContext","fallbackRouteParams","renderOpts","App","Document","pageConfig","Component","postponed","shouldWaitOnAllReady","serveStreamingMetadata","supportsDynamicResponse","setIsrStatus","dir","relativeProjectDir","isDraftMode","assetPrefix","nextConfigOutput","output","crossOrigin","trailingSlash","images","previewProps","enableTainting","experimental","taint","htmlLimitedBots","reactMaxHeadersLength","cacheLifeProfiles","cacheLife","basePath","serverActions","cacheComponents","Boolean","isRoutePPREnabled","expireTime","staleTimes","dynamicOnHover","optimisticRouting","inlineCss","authInterrupts","clientTraceMetadata","clientParamParsingOrigins","maxPostponedStateSizeBytes","maxPostponedStateSize","incrementalCache","getIncrementalCache","waitUntil","bind","onClose","cb","onAfterTaskError","onInstrumentationRequestError","error","_request","errorContext","silenceLog","onRequestError","dev","isDev","finalStatus","renderResultToResponse","result","varyHeader","getVaryHeader","isNull","dispatchClose","metadata","Headers","statusCode","fetchMetrics","contentType","set","key","value","Object","entries","getHeaders","Array","isArray","v","append","String","isDynamic","body","toUnchunkedString","TextEncoder","encode","length","readable","writable","TransformStream","pipeTo","catch","err","console","finally","invokeRender","span","render","setAttributes","rootSpanAttributes","tracer","getRootSpanAttributes","handleRequest","warn","route","name","method","updateName","routerKind","routePath","routeType","revalidateReason","withPropagatedContext","trace","spanName","kind","SERVER","attributes","internalHandler","opts","handler","incrementalCacheHandler","request","ctx","url","process","env","__NEXT_BASE_PATH","i18n","__NEXT_I18N_CONFIG","__NEXT_TRAILING_SLASH","__NEXT_CACHE_LIFE","__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS","__NEXT_CLIENT_PARAM_PARSING_ORIGINS","requestMeta","signal","AbortController","response"],"mappings":"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","ignoreList":[0]}